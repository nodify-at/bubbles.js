"use strict";!function(){function t(t,e){function n(n,i,r){var o,s={enableDrop:n.enableDrop,handleDrop:n.handleDrop,enableFlip:n.enableFlip,disableNavigationSingleNode:n.disableNavigationSingleNode,scaleFactor:n.scaleFactor,ready:function(t){},navigateTo:n.navigateTo,onClick:function(t){"function"==typeof n.nodeSelected&&n.nodeSelected(t),t.clickCount=t.clickCount?t.clickCount+1:1,t.detail}},a=$(".bubbletree").get(0);n.$watch("data",function(i,r){if(i!==r&&!o){var h=t.parse(n.data);o=e.build(h,a,s)}},!0)}return{restrict:"A",scope:{nodeSelected:"=",navigateTo:"=",data:"=",scaleFactor:"@",disableNavigationSingleNode:"@",enableDrop:"@",enableFlip:"@",handleDrop:"="},link:n}}var e=angular.module("tribefire.bubble",[]);e.directive("tribefireBubble",t),t.$inject=["DataParser","BubbleTreeFactory"]}(),function(){function t(){function t(t,e,n){var i={};return i.enableDrop=n.enableDrop,i.handleDrop=n.handleDrop,i.enableFlip=n.enableFlip,i.disableNavigationSingleNode=n.disableNavigationSingleNode,i.data=t,i.container=e,i.bubbleType="donut",i.scaleFactor=n.scaleFactor,i.ready=function(e,i){$(".amount").remove(),n.ready(t)},i.navigateTo=n.navigateTo,i.onClick=n.onClick,i.rootPath="./",new BubbleTree(i)}return{build:t}}var e=angular.module("tribefire.bubble");e.factory("BubbleTreeFactory",t)}(),!function(t){"function"==typeof define&&define.amd?define(["jquery"],function(e){return t(e)}):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery")):t(window.jQuery)}(function(t){function e(t){void 0===t&&(t=window.navigator.userAgent),t=t.toLowerCase();var e=/(edge)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],n=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(silk)/.exec(t)||/(android)/.exec(t)||/(windows phone)/.exec(t)||/(win)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||/(playbook)/.exec(t)||/(bb)/.exec(t)||/(blackberry)/.exec(t)||[],i={},r={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",versionNumber:e[4]||e[2]||"0",platform:n[0]||""};if(r.browser&&(i[r.browser]=!0,i.version=r.version,i.versionNumber=parseInt(r.versionNumber,10)),r.platform&&(i[r.platform]=!0),(i.android||i.bb||i.blackberry||i.ipad||i.iphone||i.ipod||i.kindle||i.playbook||i.silk||i["windows phone"])&&(i.mobile=!0),(i.cros||i.mac||i.linux||i.win)&&(i.desktop=!0),(i.chrome||i.opr||i.safari)&&(i.webkit=!0),i.rv||i.edge){var o="msie";r.browser=o,i[o]=!0}if(i.safari&&i.blackberry){var s="blackberry";r.browser=s,i[s]=!0}if(i.safari&&i.playbook){var a="playbook";r.browser=a,i[a]=!0}if(i.bb){var h="blackberry";r.browser=h,i[h]=!0}if(i.opr){var l="opera";r.browser=l,i[l]=!0}if(i.safari&&i.android){var c="android";r.browser=c,i[c]=!0}if(i.safari&&i.kindle){var u="kindle";r.browser=u,i[u]=!0}if(i.safari&&i.silk){var b="silk";r.browser=b,i[b]=!0}return i.name=r.browser,i.platform=r.platform,i}return window.jQBrowser=e(window.navigator.userAgent),window.jQBrowser.uaMatch=e,t&&(t.browser=window.jQBrowser),window.jQBrowser});var TWEEN=TWEEN||function(){var t,e,n,i,r=[];return{start:function(t){n=setInterval(this.update,1e3/(t||60))},stop:function(){clearInterval(n)},add:function(t){r.push(t)},remove:function(e){t=r.indexOf(e),t!==-1&&r.splice(t,1)},update:function(){for(t=0,e=r.length,i=(new Date).getTime();t<e;)r[t].update(i)?t++:(r.splice(t,1),e--)}}}();TWEEN.Tween=function(t){var e={},n={},i={},r=1e3,o=0,s=null,a=TWEEN.Easing.Linear.EaseNone,h=null,l=null,c=null;this.to=function(e,n){null!==n&&(r=n);for(var o in e)null!==t[o]&&(i[o]=e[o]);return this},this.start=function(){TWEEN.add(this),s=(new Date).getTime()+o;for(var r in i)null!==t[r]&&(e[r]=t[r],n[r]=i[r]-t[r]);return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(t){return o=t,this},this.easing=function(t){return a=t,this},this.chain=function(t){h=t},this.onUpdate=function(t){return l=t,this},this.onComplete=function(t){return c=t,this},this.update=function(i){var o,u;if(i<s)return!0;i=(i-s)/r,i=i>1?1:i,u=a(i);for(o in n)t[o]=e[o]+n[o]*u;return null!==l&&l.call(t,u),1!=i||(null!==c&&c.call(t),null!==h&&h.start(),!1)}},TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},TWEEN.Easing.Linear.EaseNone=function(t){return t},TWEEN.Easing.Quadratic.EaseIn=function(t){return t*t},TWEEN.Easing.Quadratic.EaseOut=function(t){return-t*(t-2)},TWEEN.Easing.Quadratic.EaseInOut=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},TWEEN.Easing.Cubic.EaseIn=function(t){return t*t*t},TWEEN.Easing.Cubic.EaseOut=function(t){return--t*t*t+1},TWEEN.Easing.Cubic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},TWEEN.Easing.Quartic.EaseIn=function(t){return t*t*t*t},TWEEN.Easing.Quartic.EaseOut=function(t){return-(--t*t*t*t-1)},TWEEN.Easing.Quartic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},TWEEN.Easing.Quintic.EaseIn=function(t){return t*t*t*t*t},TWEEN.Easing.Quintic.EaseOut=function(t){return(t-=1)*t*t*t*t+1},TWEEN.Easing.Quintic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},TWEEN.Easing.Sinusoidal.EaseIn=function(t){return-Math.cos(t*Math.PI/2)+1},TWEEN.Easing.Sinusoidal.EaseOut=function(t){return Math.sin(t*Math.PI/2)},TWEEN.Easing.Sinusoidal.EaseInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},TWEEN.Easing.Exponential.EaseIn=function(t){return 0==t?0:Math.pow(2,10*(t-1))},TWEEN.Easing.Exponential.EaseOut=function(t){return 1==t?1:-Math.pow(2,-10*t)+1},TWEEN.Easing.Exponential.EaseInOut=function(t){return 0==t?0:1==t?1:(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)},TWEEN.Easing.Circular.EaseIn=function(t){return-(Math.sqrt(1-t*t)-1)},TWEEN.Easing.Circular.EaseOut=function(t){return Math.sqrt(1- --t*t)},TWEEN.Easing.Circular.EaseInOut=function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},TWEEN.Easing.Elastic.EaseIn=function(t){var e,n=.1,i=.4;return 0==t?0:1==t?1:(i||(i=.3),!n||n<1?(n=1,e=i/4):e=i/(2*Math.PI)*Math.asin(1/n),-(n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i)))},TWEEN.Easing.Elastic.EaseOut=function(t){var e,n=.1,i=.4;return 0==t?0:1==t?1:(i||(i=.3),!n||n<1?(n=1,e=i/4):e=i/(2*Math.PI)*Math.asin(1/n),n*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/i)+1)},TWEEN.Easing.Elastic.EaseInOut=function(t){var e,n=.1,i=.4;return 0==t?0:1==t?1:(i||(i=.3),!n||n<1?(n=1,e=i/4):e=i/(2*Math.PI)*Math.asin(1/n),(t*=2)<1?-.5*n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i):n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i)*.5+1)},TWEEN.Easing.Back.EaseIn=function(t){return t*t*(2.70158*t-1.70158)},TWEEN.Easing.Back.EaseOut=function(t){return(t-=1)*t*(2.70158*t+1.70158)+1},TWEEN.Easing.Back.EaseInOut=function(t){return(t*=2)<1?.5*t*t*(3.5949095*t-2.5949095):.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)},TWEEN.Easing.Bounce.EaseIn=function(t){return 1-TWEEN.Easing.Bounce.EaseOut(1-t)},TWEEN.Easing.Bounce.EaseOut=function(t){return(t/=1)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},TWEEN.Easing.Bounce.EaseInOut=function(t){return t<.5?.5*TWEEN.Easing.Bounce.EaseIn(2*t):.5*TWEEN.Easing.Bounce.EaseOut(2*t-1)+.5};var vis4=function(){};vis4.log=function(){try{null!==window.console&&console.log.apply(this,arguments)}catch(t){}},vis4.str2time=function(t){var e=t.split(".");return Math.round(.001*Date.UTC(2e3+e[0],e[1]-1,e[2]))},vis4.round=function(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n},vis4.formatNumber_ksep=".",vis4.formatNumber_dsep=",",vis4.formatNumber=function(t,e){t=""+t;for(var n="",i=0,r=t.length-1;r>=0;r--)i>0&&i<t.length&&i%3==0&&(n=vis4.formatNumber_ksep+n),n=t[r]+n,i++;return n},vis4.parseTSV=function(t,e){var n,i,r=t.split("\n"),o=[];for(i=0;i<r.length;i++){var s=r[i];if(""!==s)if(e)if(0===i)n=s.split("\t");else{var a={},h=s.split("\t");if(h.length!=n.length)return"wrong tsv format";for(var l=0;l<n.length;l++)a[$.trim(n[l])]=$.trim(h[l]);o.push(a)}else o.push(s.split("\t"))}return o},vis4.map=function(t,e){for(var n={},i=0;i<t.length;i++)n[t[i][e]]=t[i];return n},vis4.DelayedTask=function(){var t=this;t.init=function(t){var e=this,n=[];for(var i in t)i>2&&n.push(t[i]);e.func=t[2],e.scope=t[1],e.args=n,e.running=!0,e.timer=window.setTimeout(this.run.bind(e),t[0])},t.run=function(){var t=this;t.func.apply(t.scope,t.args),t.running=!1},t.cancel=function(){vis4.log("canceling timer",this),window.clearTimeout(this.timer),this.running=!1},t.init(arguments)};var vis4loadingItem=function(t,e,n,i){this.url=t,this.id=e,this.type=n,this.loader=i,this.load=function(){$.get(this.url,this.processContent.bind(this))},this.processContent=function(t){"tsv"==this.type?this.data=vis4.parseTSV(t,!0):"json"==this.type?this.data="string"==typeof t?$.parseJSON(t):t:this.data=t,this.loader.itemLoaded()}},vis4loader=function(){this.items=[],this.byID={},this.add=function(t,e,n){null===n&&(n="text");var i=new vis4loadingItem(t,e,n,this);this.items.push(i),this.byID[e]=i},this.load=function(t){this.callback=t,this.loaded=0;for(var e=0;e<this.items.length;e++)this.items[e].load()},this.itemLoaded=function(){this.loaded++,this.loaded==this.items.length&&this.callback(this)},this.get=function(t){return this.byID[t].data}};Function.prototype.bind=function(t){var e=this;return function(){return e.apply(t,arguments)}};var vis4color=function(t){this.h=0,this.s=.5,this.l=.8,this.v=1,this.i=1,this.r=255,this.g=0,this.b=0,this.x="#FF0000",this.u=0,this.br=1,this.K=1/180*Math.PI,"hsi"!=t&&"hsl"!=t&&"hsb"!=t&&"hsv"!=t||(this.mode=t),this.log=function(t){null!==window.console&&console.log(t)},this.cos=function(t){return Math.cos(t*this.K)},this.trim=function(t){return Math.max(0,Math.min(1,t))},this.setMode=function(t){"hsv"!=t&&"hsi"!=t&&"hsl"!=t&&"hsb"!=t&&this.log("unknown color mode "+t),this.mode=t,this.rgb2hsx()},this.setHexColor=function(t){"#"!=t.charAt(0)&&(t="#"+t),4==t.length&&(t="#"+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)+t.charAt(3)+t.charAt(3)),7!=t.length&&this.log("invalid hex color"),this.x=t,this.hex2int(),this.int2rgb(),this.rgb2hsx()},this.setRGBColor=function(t,e,n){this.r=t,this.b=n,this.g=e,this.rgb2int(),this.int2hex(),this.rgb2hsx()},this.setHSVColor=function(t,e,n){"hsv"!=this.mode&&(this.mode="hsv"),this.h=t,this.s=this.trim(e),this.v=this.trim(n),this.hsv2rgb(),this.rgb2int(),this.int2hex()},this.setHSLColor=function(t,e,n){"hsl"!=this.mode&&(this.mode="hsl"),this.h=t,this.s=this.trim(e),this.l=this.trim(n),this.hsl2rgb(),this.rgb2int(),this.int2hex()},this.setHSBColor=function(t,e,n){"hsb"!=this.mode&&(this.mode="hsb"),this.h=t,this.s=this.trim(e),this.b=this.trim(n),this.hsb2rgb(),this.rgb2int(),this.int2hex()},this.setHSIColor=function(t,e,n){"hsi"!=this.mode&&(this.mode="hsi"),this.h=t,this.s=this.trim(e),this.i=this.trim(n),this.hsi2rgb(),this.rgb2int(),this.int2hex()},this.onChange=function(){},this.rgb2int=function(){this.u=this.r<<16|this.g<<8|this.b,this.onChange()},this.int2rgb=function(){this.r=this.u>>16,this.g=this.u>>8&255,this.b=255&this.u},this.hex2int=function(){this.u=parseInt(this.x.substr(1),16),this.onChange()},this.int2hex=function(){var t="000000"+this.u.toString(16).toUpperCase();this.x="#"+t.substr(t.length-6),this.onChange()},this.int2rgb=function(){this.r=this.u>>16,this.g=this.u>>8&255,this.b=255&this.u},this.hsx2rgb=function(){switch(this.mode){case"hsv":this.hsv2rgb();break;case"hsi":this.hsi2rgb();break;case"hsl":this.hsl2rgb();break;case"hsb":this.hsb2rgb()}},this.rgb2hsx=function(){switch(this.mode){case"hsv":this.rgb2hsv();break;case"hsi":this.rgb2hsi();break;case"hsl":this.rgb2hsl();break;case"hsb":this.rgb2hsb()}},this.hue=function(t){return this._evaluate(t,"h"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this},this.saturation=function(t){return this._evaluate(t,"s"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this},this.lightness=function(t){return"hsl"!=this.mode?void this.log("WARNING: lightness property not available in "+this.mode+" mode"):(this._evaluate(t,"l"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this)},this.brightness=function(t){return"hsb"!=this.mode?void this.log("WARNING: brightness property not available in "+this.mode+" mode"):(this._evaluate(t,"br"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this)},this.value=function(t){return"hsv"!=this.mode?void this.log("WARNING: value property not available in "+this.mode+" mode"):(this._evaluate(t,"v"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this)},this.intensity=function(t){return"hsi"!=this.mode?void this.log("WARNING: intensity property not available in "+this.mode+" mode"):(this._evaluate(t,"i"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this)},this._evaluate=function(t,e){"string"==typeof t?("+"!=t.charAt(0)||isNaN(t.substr(1))?"-"!=t.charAt(0)||isNaN(t.substr(1))||(this[e]=this[e]-Number(t.substr(1))):this[e]=Number(this[e])+Number(t.substr(1)),"*"!=t.charAt(0)||isNaN(t.substr(1))?"/"!=t.charAt(0)||isNaN(t.substr(1))||(this[e]=this[e]/Number(t.substr(1))):this[e]=this[e]*Number(t.substr(1))):isNaN(t)||(this[e]=Number(t))},this.rgb=function(){return[this.r,this.g,this.b]},this.hsl=function(){return[this.h,this.s,this.l]},this.rgb2hsv=function(){var t=Math.min(Math.min(this.r,this.g),this.b),e=Math.max(Math.max(this.r,this.g),this.b),n=e-t;this.v=e/255,this.s=n/e,0===this.s?this.h=void 0:(this.r==e&&(this.h=(this.g-this.b)/n),this.g==e&&(this.h=2+(this.b-this.r)/n),this.b==e&&(this.h=4+(this.r-this.g)/n),this.h*=60,this.h<0&&(this.h+=360))},this.hsv2rgb=function(){var t,e,n,i,r,o=this.h,s=this.s,a=this._rgb,h=255*this.v;if(0===this.s&&isNaN(o))this.r=this.g=this.b=h;else switch(360==o&&(o=0),o/=60,t=Math.floor(o),e=o-t,n=h*(1-s),i=h*(1-s*e),r=h*(1-s*(1-e)),t){case 0:a(h,r,n);break;case 1:a(i,h,n);break;case 2:a(n,h,r);break;case 3:a(n,i,h);break;case 4:a(r,n,h);break;case 5:a(h,n,i)}},this._rgb=function(t,e,n){this.r=t,this.g=e,this.b=n},this.rgb2hsl=function(){var t=this.r/255,e=this.g/255,n=this.b/255,i=Math.min(Math.min(t,e),n),r=Math.max(Math.max(t,e),n);this.l=(r+i)/2,r==i?(this.s=0,this.h=void 0):this.l<.5?this.s=(r-i)/(r+i):this.s=(r-i)/(2-r-i),t==r?this.h=(e-n)/(r-i):e==r?this.h=2+(n-t)/(r-i):n==r&&(this.h=4+(t-e)/(r-i)),this.h*=60,this.h<0&&(this.h+=360)},this.hsl2rgb=function(){if(0===this.s)this.r=this.g=this.b=255*this.l;else{var t,e,n=[0,0,0],i=[0,0,0];e=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,t=2*this.l-e;var r=this.h/360;n[0]=r+1/3,n[1]=r,n[2]=r-1/3;for(var o=0;o<3;o++)n[o]<0&&(n[o]+=1),n[o]>1&&(n[o]-=1),6*n[o]<1?i[o]=t+6*(e-t)*n[o]:2*n[o]<1?i[o]=e:3*n[o]<2?i[o]=t+(e-t)*(2/3-n[o])*6:i[o]=t;this.r=255*i[0],this.g=255*i[1],this.b=255*i[2]}},this.rgb2hsb=function(){this.rgb2hsl(),this.br=this._rgbLuminance()},this._rgbLuminance=function(){return(.2126*this.r+.7152*this.g+.0722*this.b)/255},this.hsb2rgb=function(){var t,e=.001,n=0,i=1,r=.5;this.l=r,this.hsl2rgb(),t=this._rgbLuminance();for(var o=0;Math.abs(t-this.br)>e&&o<100;)t>this.br?i=r:n=r,r=(n+i)/2,this.l=r,this.hsl2rgb(),t=this._rgbLuminance(),o++;this.br=t},this.rgb2hsi=function(){var t,e=this.r,n=this.g,i=this.b,r=(Math.max(Math.max(e,n),i),e+n+i);e/=r,n/=r,i/=r,t=Math.min(Math.min(e,n),i),this.i=(e+n+i)/765,this.h=this.acos((e-.5*n-.5*i)/Math.sqrt((e-n)*(e-n)+(e-i)*(n-i))),this.s=1-3*t,i>n&&(this.h=360-this.h)},this.hsi2rgb=function(){var t,e,n,i=this.h,r=this.i,o=this.s,s=this.cos;i<=120?(e=(1-o)/3,t=(1+o*s(i)/s(60-i))/3,n=1-(e+t)):i<=240?(i-=120,t=(1-o)/3,n=(1+o*s(i)/s(60-i))/3,e=1-(t+n)):(i-=240,n=(1-o)/3,e=(1+o*s(i)/s(60-i))/3,t=1-(n+e)),t=Math.min(255,t*r*3*255),n=Math.min(255,n*r*3*255),e=Math.min(255,e*r*3*255)}};vis4color.fromHex=function(t,e){null==e&&(e="hsl");var n=new vis4color(e);return n.setHexColor(t),n},vis4color.fromRGB=function(t,e,n,i){null===i&&(i="hsl");var r=new vis4color(i);return r.setRGBolor(t,e,n),r},vis4color.fromHSV=function(t,e,n,i){null===i&&(i="hsl");var r=new vis4color(i);return r.setHSVColor(t,e,n),r},vis4color.fromHSL=function(t,e,n,i){null===i&&(i="hsl");var r=new vis4color(i);return r.setHSLColor(t,e,n),r},vis4color.fromHSB=function(t,e,n,i){null===i&&(i="hsl");var r=new vis4color(i);return r.setHSBColor(t,e,n),r},vis4color.fromHSI=function(t,e,n,i){null===i&&(i="hsl");var r=new vis4color(i);return r.setHSIColor(t,e,n),r};var BubbleTree=function(t,e,n){var i=this;if(i.version="2.0.2",i.$container=$(t.container),i.config=$.extend({rootPath:"",minRadiusLabels:40,minRadiusAmounts:20,minRadiusHideLabels:0,cutLabelsAt:50},t),i.tooltip=t.tooltipCallback?t.tooltipCallback:function(){},t.tooltip&&(i.tooltip=t.tooltip),i.style=t.bubbleStyles,i.ns=BubbleTree,i.nodesByUrlToken={},i.nodeList=[],i.iconsByUrlToken={},i.globalNodeCounter=0,i.displayObjects=[],i.bubbleScale=1,i.globRotation=0,i.currentYear=t.initYear,i.currentCenter=void 0,i.currentTransition=void 0,i.baseUrl="",i.loadData=function(t){$.ajax({url:t,dataType:"json",success:this.setData.bind(this)})},i.setData=function(t){var e=this;t||(t=e.config.data),e.initData(t),e.initPaper(),e.initBubbles(),e.initTween(),e.initHistory(),e.postProcess(t)},i.postProcess=function(t){if(t){var e=this;angular.forEach(t.children,function(t){e.postProcess(t)})}},i.initData=function(t){var e=this;t.level=0,e.preprocessData(t),e.traverse(t,0),e.treeRoot=t},i.preprocessData=function(t){var e=this,n=e.config.maxNodesPerLevel;if(n&&n<t.children.length){var i=e.sortChildren(t.children);i.reverse();var r,o=[],s=[],a=0;for(var h in t.children)h<n?o.push(t.children[h]):(s.push(t.children[h]),a+=Math.max(0,t.children[h].amount));t.children=o,t.children.push({label:"More",name:"more",amount:a,children:s,breakdown:r})}},i.traverse=function(t,e){var n,i,r=this,o=r.config.bubbleStyles;if(t.children||(t.children=[]),r.nodeList.push(t),t.famount=r.ns.Utils.formatNumber(t.amount),t.parent&&(t.level=t.parent.level+1),r.config.clearColors===!0&&(t.color=!1),o){var s=["color","shortLabel","icon"];$.each(s,function(e,n){o.hasOwnProperty("id")&&o.id.hasOwnProperty(t.id)&&o.id[t.id].hasOwnProperty(n)?t[n]=o.id[t.id][n]:t.hasOwnProperty("name")&&o.hasOwnProperty("name")&&o.name.hasOwnProperty(t.name)&&o.name[t.name].hasOwnProperty(n)?t[n]=o.name[t.name][n]:t.hasOwnProperty("taxonomy")&&o.hasOwnProperty(t.taxonomy)&&o[t.taxonomy].hasOwnProperty(t.name)&&o[t.taxonomy][t.name].hasOwnProperty(n)&&(t[n]=o[t.taxonomy][t.name][n])})}for(t.color||(t.level>0?t.color=t.parent.color:t.color="#999999"),t.children.length<2&&t.color&&(t.color=vis4color.fromHex(t.color).saturation("*.86").x),t.level>0&&(n=t.parent.children,n.length>1&&(t.left=n[(e-1+n.length)%n.length],t.right=n[(Number(e)+1)%n.length],t.right==t.left&&(t.right=void 0))),i=void 0!==t.label&&""!==t.label?t.label:void 0!==t.token&&""!==t.token?t.token:""+r.globalNodeCounter,r.globalNodeCounter++,t.urlToken=i.toLowerCase().replace(/\W/g,"-");r.nodesByUrlToken.hasOwnProperty(t.urlToken);)t.urlToken+="-";r.nodesByUrlToken[t.urlToken]=t,t.maxChildAmount=0,t.children=r.sortChildren(t.children,!0,r.config.sortBy),$.each(t.children,function(e,n){n.parent=t,t.maxChildAmount=Math.max(t.maxChildAmount,n.amount),r.traverse(n,e)}),t.breakdowns&&(t.breakdownsByName={},$.each(t.breakdowns,function(e,n){n.famount=r.ns.Utils.formatNumber(n.amount),n.name&&(t.breakdownsByName[n.name]=n)}))},i.sortChildren=function(t,e,n){var r=[],o=!0;if("label"==n?(n=i.compareLabels,e=!1):n=i.compareAmounts,t.sort(n),e){for(;t.length>0;)r.push(o?t.pop():t.shift()),o=!o;return r}return t},i.compareAmounts=function(t,e){return t.amount>e.amount?1:t.amount==e.amount?0:-1},i.compareLabels=function(t,e){return t.label>e.label?1:t.label==e.label?0:-1},i.initPaper=function(){var t,e=this,n=e.$container,i=e.treeRoot,r=n.width(),o=n.height(),s=Raphael(n[0],r,o),a=.5*Math.min(r,o)-40,h=e.ns.Vector,l=new h(.5*r,.5*o);e.width=r,e.height=o,e.paper=s,t=Math.pow((Math.pow(i.amount,.6)+2*Math.pow(i.maxChildAmount,.6))/a,1.6666666667),e.a2radBase=e.ns.a2radBase=t,e.origin=l,$(window).resize(e.onResize.bind(e))},i.onResize=function(){var t,e=this,n=e.$container,i=n.width(),r=n.height(),o=.5*Math.min(i,r)-40,s=e.treeRoot;e.paper.setSize(i,r),e.origin.x=.5*i,e.origin.y=.5*r,e.width=i,e.height=r,t=Math.pow((Math.pow(s.amount,.6)+2*Math.pow(s.maxChildAmount,.6))/o,1.6666666667),e.a2radBase=e.ns.a2radBase=t,$.each(e.displayObjects,function(t,n){"bubble"==n.className&&(n.bubbleRad=e.ns.Utils.amount2rad(n.node.amount))}),e.currentCenter&&e.changeView(e.currentCenter.urlToken)},i.initTween=function(){this.tweenTimer=setInterval(this.loop,500/120)},i.initBubbles=function(){var t=this,e=t.treeRoot,n=!1;t.ns.Bubbles;t.bubbleClasses=[],t.config.hasOwnProperty("bubbleType")||(t.config.bubbleType=["plain"]),$.isArray(t.config.bubbleType)||(t.config.bubbleType=[t.config.bubbleType]),$.isArray(t.config.bubbleType)&&$.each(t.config.bubbleType,function(e){"icon"==t.config.bubbleType[e]&&(n=!0),t.bubbleClasses.push(t.getBubbleType(t.config.bubbleType[e]))});var i=t.createBubble(e,t.origin,0,0,e.color);t.traverseBubbles(i)},i.getBubbleType=function(t){var e=this,n=e.ns.Bubbles;return n.Donut},i.traverseBubbles=function(t){var e,n,i,r,o,s=this,a=s.ns.Utils.amount2rad,h=0,l=0,c=2*Math.PI;n=t.node.children,$.each(n,function(t,e){h+=a(e.amount)}),n.length>0&&(e=s.createRing(t.node,t.pos,0,{stroke:"#888","stroke-dasharray":"-"})),$.each(n,function(e,n){r=a(n.amount)/h*c,o=l+.5*r,isNaN(o)&&vis4.log(l,r,n.amount,h,c),n.centerAngle=o,i=s.createBubble(n,t.pos,0,o,n.color),l+=r,s.traverseBubbles(i)})},i.createBubble=function(t,e,n,i,r){var o,s=this,a=(s.ns,t.level);return isNaN(a)&&(a=0),a=Math.min(a,s.bubbleClasses.length-1),o=new s.bubbleClasses[a](t,s,e,n,i,r),s.displayObjects.push(o),o},i.createRing=function(t,e,n,i){var r,o=this,s=o.ns;return r=new s.Ring(t,o,e,n,i),o.displayObjects.push(r),r},i.changeView=function(t){var e,n,i,r=this,o=(r.paper,.35*Math.min(r.width,r.height)),s=r.ns,a=s.Utils,h=r.origin,l=a.amount2rad,c=r.treeRoot,u=r.nodesByUrlToken,b=u.hasOwnProperty(t)?u[t]:null,d=new s.Layout,f=2*Math.PI,g=r.getBubble.bind(r),p=r.getRing.bind(r),v=r.unifyAngle;if(null!==b){var m,w,y,E,k,x,T,M,N,C,B,O=!1,P=!1;for(i in r.displayObjects)r.displayObjects[i].hideFlag=!0;if(b==c||b.parent==c&&b.children.length<2){d.$(r).bubbleScale=r.config.scaleFactor?r.config.scaleFactor:1,d.$(h).x=.5*r.width,d.$(h).y=.5*r.height,m=g(c),b!=c&&(m.childRotation=-b.centerAngle),k=l(c.amount)+l(c.maxChildAmount)+40,N=p(c),d.$(N).rad=k;for(i in c.children)E=c.children[i],e=g(E),d.$(e).angle=v(E.centerAngle+m.childRotation),d.$(e).rad=k}else{var I=b;C=b.children.length<2?5:o/(l(b.amount)+1.5*l(b.maxChildAmount)),d.$(r).bubbleScale=C,m=g(b),r.currentCenter&&r.currentCenter==b.left?P=!0:r.currentCenter&&r.currentCenter==b.right&&(O=!0);var A=r.shortestAngleTo;O&&(A=r.shortestLeftTurn),P&&(A=r.shortestRightTurn),d.$(m).angle=A(m.angle,0),k=(l(b.amount)+l(b.maxChildAmount))*C+20,N=p(b),d.$(N).rad=k,w=g(b.parent),w.childRotation=-b.centerAngle;for(var D=w;D&&D.node.parent;)D=g(D.node.parent,!0),d.$(D).rad=0;d.$(w).rad=0;var W=.5*r.width;if(x=0-Math.max(.8*W-C*(l(b.parent.amount)+l(Math.max(1.15*b.amount+1.15*b.maxChildAmount,.85*b.left.amount,.85*b.right.amount))),C*l(b.parent.amount)*-1+.15*W)+W,b.left&&b.right){C*l(Math.max(b.left.amount,b.right.amount))}B=k+x,d.$(h).x=.5*r.width-x-(b!=I?.35*k:0),d.$(h).y=.5*r.height,new vis4.DelayedTask(1500,vis4,vis4.log,h,w.pos),x+=.1*r.width,N=p(b.parent),d.$(N).rad=x,d.$(m).rad=x;var L=0-(b!=I?I.centerAngle+m.childRotation:0);for(i in b.children)E=b.children[i],e=g(E),d.$(e).angle=r.shortestAngleTo(e.angle,E.centerAngle+m.childRotation+L),d.$(e).rad=k;var R=.07*r.height;b.left&&(y=b.left,T=l(y.amount)*C,M=f-Math.asin((.5*r.paper.height+T-R)/x),e=g(y),d.$(e).rad=x,d.$(e).angle=A(e.angle,M)),b.right&&(y=b.right,T=l(y.amount)*C,M=Math.asin((.5*r.paper.height+T-R)/x),e=g(y),d.$(e).rad=x,d.$(e).angle=A(e.angle,M)),b=I}for(i in r.displayObjects){var S=r.displayObjects[i];S.hideFlag&&S.visible?(d.$(S).alpha=0,"bubble"==S.className&&S.node.level>1&&(d.$(S).rad=0),d.hide(S)):S.hideFlag||(d.$(S).alpha=1,S.visible||(S.alpha=0,d.show(S)))}n=new s.Transitioner($.browser.msie||r.currentCenter==b?0:560),n.changeLayout(d),r.currentTransition=n,!r.currentCenter&&$.isFunction(r.config.firstNodeCallback)&&r.config.firstNodeCallback(b),r.currentCenter=b}else a.log("node "+t+" not found")},i.unifyAngle=function(t){for(var e=Math.PI,n=2*e;t>=n;)t-=n;for(;t<0;)t+=n;return t},i.shortestAngle=function(t,e){var n=Math.PI,r=2*n,o=i.unifyAngle;t=o(t),e=o(e);var s=e-t;return s>n&&(s-=r),s<-n&&(s+=r),s},i.shortestAngleTo=function(t,e){return t+i.shortestAngle(t,e)},i.shortestLeftTurn=function(t,e){var n=i.shortestAngle(t,e);return n>0&&(n-=2*Math.PI),t+n},i.shortestRightTurn=function(t,e){var n=i.shortestAngle(t,e);return n<0&&(n=2*Math.PI+n),t+n},i.getBubble=function(t,e){return this.getDisplayObject("bubble",t,e)},i.getRing=function(t){return this.getDisplayObject("ring",t)},i.getDisplayObject=function(t,e,n){var i,r,o=this;for(i in o.displayObjects)if(r=o.displayObjects[i],r.className==t&&r.node==e)return n||(r.hideFlag=!1),r;vis4.log(t+" not found for node",e)},i.initHistory=function(){$.history.init(i.urlChanged.bind(i),{unescape:",/"})},i.freshUrl="",i.urlChanged=function(t){var e=this,n=e.currentTransition;e.freshUrl||t.indexOf("/~/")&&(e.baseUrl=t.substr(0,t.indexOf("/~/"))),e.freshUrl=t,n&&n.running?(vis4.log("transition is running at the moment, adding listener"),n.onComplete(e.changeUrl.bind(e))):e.changeUrl()},i.changeUrl=function(){var t,e=this,n=e.freshUrl.split("/"),i=n[n.length-1];""===e.freshUrl&&e.navigateTo(e.treeRoot),e.nodesByUrlToken.hasOwnProperty(i)?(t=e.getUrlForNode(e.nodesByUrlToken[i]),e.freshUrl!=t?$.history.load(t):e.navigateTo(e.nodesByUrlToken[i],!0)):e.navigateTo(e.treeRoot)},i.navigateTo=function(t,e){var n=this;"function"==typeof n.config.navigateTo&&(console.log(e),n.config.navigateTo(t));var i=n.getUrlForNode(t);e?n.changeView(t.urlToken):$.history.load(i),$(".label, .label2").removeClass("current"),$(".label2."+t.id).addClass("current"),$(".label."+t.id).addClass("current")},i.getUrlForNode=function(t){var e=[];for(e.push(t.urlToken);t.parent;)e.push(t.parent.urlToken),t=t.parent;return e.reverse(),i.baseUrl+"/~/"+e.join("/")},i.onNodeClick=function(t){},i.clean=function(){$(".label").remove()},this.loop=function(){TWEEN.update()},!i.config.hasOwnProperty("data"))throw new Error("no data");"string"==typeof i.config.data?i.loadData():new vis4.DelayedTask(1e3,i,i.setData,i.config.data)};BubbleTree.Styles={},BubbleTree.Layout=function(){var t=this;t.objects=[],t.props=[],t.toHide=[],t.toShow=[],t.$=function(t){var e,n,i,r=this;for(e in r.objects)if(n=r.objects[e],n==t)return r.props[e];return r.objects.push(t),i={},r.props.push(i),i},t.show=function(t){var e=this;e.toShow.push(t)},t.hide=function(t){var e=this;e.toHide.push(t)}},BubbleTree.Line=function(t,e,n,i,r,o){this.bc=t,this.o=n,this.angle=i,this.fromRad=r,this.attr=e,this.toRad=o,this.getXY=function(){this.x1=this.o.x+Math.cos(this.angle)*this.fromRad,this.y1=this.o.y-Math.sin(this.angle)*this.fromRad,this.x2=this.o.x+Math.cos(this.angle)*this.toRad,this.y2=this.o.y-Math.sin(this.angle)*this.toRad},this.init=function(){this.getXY(),console.log("foo","M"+this.x1+" "+this.y1+"L"+this.x2+" "+this.y2,e),this.path=this.bc.paper.path("M"+this.x1+" "+this.y1+"L"+this.x2+" "+this.y2).attr(this.attr)},this.draw=function(){this.getXY(),this.path.attr({path:"M"+this.x1+" "+this.y1+"L"+this.x2+" "+this.y2})},this.init()},BubbleTree.Loader=function(t){var e=this;e.config=t,e.ns=BubbleTree,e.loadData=function(){var t=this,e=t.config.data;console.log("loading url ",e),$.ajax({url:e,context:t,dataType:"json",success:function(t){this.run(t)}})},e.run=function(t){var e=this,n=new BubbleTree(e.config);n.setData(t),e.config.instance=n},!e.config.hasOwnProperty("data"),"string"==typeof e.config.data?e.loadData():e.run(e.config.data)},BubbleTree.MouseEventGroup=function(t,e){var n=this;n.target=t,n.members=e,n.click=function(t){var e,n,i=this,r=i.members;i.clickCallback=t;for(e in r)n=r[e],$(n).click(i.handleClick.bind(i))},n.handleClick=function(t){var e=this;e.clickCallback({target:e.target,origEvent:t,mouseEventGroup:e})},n.hover=function(t){var e,n,i=this,r=i.members;i.hoverCallback=t;for(e in r)n=r[e],$(n).hover(i.handleMemberHover.bind(i),i.handleMemberUnHover.bind(i))},n.unhover=function(t){var e=this;e.unhoverCallback=t},n.wasHovering=!1,n.mouseIsOver=!1,n.handleMemberHover=function(t){var e=this;new vis4.DelayedTask(25,e,e.handleMemberHoverDelayed,t)},n.handleMemberHoverDelayed=function(t){var e=this;e.mouseIsOver=!0,e.wasHovering||(e.wasHovering=!0,$.isFunction(e.hoverCallback)&&e.hoverCallback({target:e.target,origEvent:t,mouseEventGroup:e}))},n.handleMemberUnHover=function(t){var e=this;e.mouseIsOver=!1,new vis4.DelayedTask(40,e,e.handleMemberUnHoverDelayed,t)},n.handleMemberUnHoverDelayed=function(t){var e=this;e.mouseIsOver||(e.wasHovering=!1,$.isFunction(e.unhoverCallback)&&e.unhoverCallback({target:e.target,origEvent:t,mouseEventGroup:e}))},n.addMember=function(t){var e=this;e.hoverCallback&&$(t).hover(e.handleMemberHover.bind(e),e.handleMemberUnHover.bind(e)),e.members.push(t)},n.removeMember=function(t){var e,n=this,i=n.members,r=[];n.clickCallback&&$(t).unbind("click"),n.hoverCallback&&$(t).unbind("mouseenter mouseleave");for(e in i)i[e]!=t&&r.push(i[e]);n.members=r}},BubbleTree.Ring=function(t,e,n,i,r){var o=this;o.className="ring",o.rad=i,o.bc=e,o.attr=r,o.origin=n,o.alpha=1,o.visible=!1,o.node=t,o.init=function(){},o.draw=function(){var t=this,e=t.origin;t.visible&&t.circle.attr({cx:e.x,cy:e.y,r:t.rad,"stroke-opacity":t.alpha})},o.hide=function(){var t=this;t.circle.remove(),t.visible=!1},o.show=function(){var t=this;t.circle=t.bc.paper.circle(n.x,n.y,t.rad).attr(t.attr),t.visible=!0,t.circle.toBack()},o.init()},BubbleTree.Transitioner=function(t){var e=this;e.duration=t,e.running=!1,e.completeCallbacks=[],e.changeLayout=function(t){var e,n,i,r,o=this;o.running=!0,o.layout=t;for(e in t.toShow)n=t.toShow[e],$.isFunction(n.show)&&n.show();for(e in t.objects)if(n=t.objects[e],void 0!==n&&null!==n)if(i=t.props[e],o.duration>0){var s=new TWEEN.Tween(n),a={};for(r in i)a[r]=i[r];s.to(a,.6*o.duration),s.easing(TWEEN.Easing.Exponential.EaseOut),$.isFunction(n.draw)&&s.onUpdate(n.draw.bind(n)),e==t.objects.length-1&&s.onComplete(o._completed.bind(o)),s.start()}else{for(r in i)n[r]=i[r];n&&$.isFunction(n.draw)&&n.draw()}if(0===o.duration){for(e in t.objects)n=t.objects[e],n&&$.isFunction(n.draw)&&n.draw();o._completed()}},e.onComplete=function(t){var e=this;try{$.isFunction(t)&&e.completeCallbacks.push(t)}catch(t){}},e._completed=function(){var t,e,n=this,i=n.completeCallbacks;n.running=!1;for(t in n.layout.objects)e=n.layout.objects[t],e&&$.isFunction(e.draw)&&e.draw();for(t in n.layout.toHide)e=n.layout.toHide[t],e&&$.isFunction(e.hide)&&e.hide();for(t in i)i[t]()}},BubbleTree.Utils={},BubbleTree.Utils.log=function(){try{window.hasOwnProperty("console")&&console.log.apply(this,arguments)}catch(t){}},BubbleTree.Utils.amount2rad=function(t){return Math.pow(Math.max(0,t)/BubbleTree.a2radBase,.6)},BubbleTree.Utils.formatNumber=function(t){var e="";return t<0&&(t*=-1,e="-"),t>=1e12?e+Math.round(t/1e11)/10+"t":t>=1e9?e+Math.round(t/1e8)/10+"b":t>=1e6?e+Math.round(t/1e5)/10+"m":t>=1e3?e+Math.round(t/100)/10+"k":e+t},BubbleTree.Vector=function(t,e){var n=this;n.x=t,n.y=e,n.length=function(){var t=this;return Math.sqrt(t.x*t.x+t.y*t.y)},n.normalize=function(t){var e=this,n=e.length();t||(t=1),e.x*=t/n,e.y*=t/n},n.clone=function(){var t=this;return new BubbleTree.Vector(t.x,t.y)}},BubbleTree.Bubbles=BubbleTree.Bubbles||{},
BubbleTree.Bubbles=BubbleTree.Bubbles||{},BubbleTree.Bubbles.Donut=function(t,e,n,i,r,o){var s=BubbleTree,a=s.Utils,h=this;h.className="bubble",h.node=t,h.paper=e.paper,h.origin=n,h.bc=e,h.rad=i,h.angle=r,h.color=o,h.alpha=1,h.visible=!1,h.ns=s,h.bubbleRad=a.amount2rad(this.node.amount),h.childRotation=0,h.getXY=function(){var t=this,e=t.origin,n=t.angle,i=t.rad;t.pos.x=e.x+Math.cos(n)*i,t.pos.y=e.y-Math.sin(n)*i},h.init=function(){var t=this;t.pos=new t.ns.Vector(0,0),t.getXY();var e,n,i,r=[],o=[],s=t.bc.config.bubbleStyles;t.node.shortLabel||(t.node.shortLabel=t.node.label.length>50?t.node.label.substr(0,30)+"...":t.node.label),t.breakdownOpacities=[.2,.7,.45,.6,.35],t.breakdownColors=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];for(n in t.node.breakdowns)e=t.node.breakdowns[n],e.famount=a.formatNumber(e.amount),i=e.amount/t.node.amount,r.push(i),o.push(e),s&&s.hasOwnProperty("name")&&s.name.hasOwnProperty(e.name)&&s.name[e.name].hasOwnProperty("opacity")&&(t.breakdownOpacities[o.length-1]=s.name[e.name].opacity),s&&s.hasOwnProperty("name")&&s.name.hasOwnProperty(e.name)&&s.name[e.name].hasOwnProperty("color")&&(t.breakdownColors[o.length-1]=s.name[e.name].color,t.breakdownOpacities[o.length-1]=1);t.node.breakdowns=o,t.breakdown=r;t.initialized=!0},h.onclick=function(e){var n=this;"function"==typeof n.bc.config.onClick&&n.bc.config.onClick(t),n.bc.navigateTo(n.node)},h.onhover=function(t){var e=this,n=e.bc.$container[0];t.node=e.node,t.target=e,t.bubblePos={x:e.pos.x,y:e.pos.y},t.mousePos={x:t.origEvent.pageX-n.offsetLeft,y:t.origEvent.pageY-n.offsetTop},t.type="SHOW",e.bc.tooltip(t)},h.onunhover=function(t){var e=this,n=e.bc.$container[0];t.node=e.node,t.target=e,t.type="HIDE",t.bubblePos={x:e.pos.x,y:e.pos.y},t.mousePos={x:t.origEvent.pageX-n.offsetLeft,y:t.origEvent.pageY-n.offsetTop},e.bc.tooltip(t)},this.draw=function(){var t=this,e=Math.max(5,t.bubbleRad*t.bc.bubbleScale),n=(t.pos.x,t.pos.y,t.getXY(),t.pos.x),i=t.pos.y;if(t.visible){t.alpha=0;var r={cx:n,cy:i,r:e,"fill-opacity":t.alpha,class:t.node.id+"-circle"};if(t.circle.attr(r),t.circle.node.setAttribute("class","circle-"+t.node.id),t.node.stroke?(t.dashedBorder.attr({cx:n,cy:i,r:e,"stroke-opacity":1}),t.dashedBorder.node.setAttribute("class",t.node.strokeClass)):t.node.dashed&&(t.dashedBorder.attr({cx:n,cy:i,r:e+3,"stroke-opacity":1,"stroke-dasharray":"- "}),t.dashedBorder.node.setAttribute("class","dashed")),t.breakdown.length>1){var o,s,a,h,l,c,u,b,d,f,g=.85*e,p=.5*-Math.PI;for(o in t.breakdown){f=t.breakdown[o]*Math.PI*2,s=n+Math.cos(p)*g,c=i+Math.sin(p)*g,a=n+Math.cos(p+f)*g,u=i+Math.sin(p+f)*g,h=n+Math.cos(p+f)*e,b=i+Math.sin(p+f)*e,l=n+Math.cos(p)*e,d=i+Math.sin(p)*e,p+=f;var v="M"+s+" "+c+" A"+g+","+g+" 0 "+(f>Math.PI?"1,1":"0,1")+" "+a+","+u+" L"+h+" "+b+" A"+e+","+e+" 0 "+(f>Math.PI?"1,0":"0,0")+" "+l+" "+d+" Z";t.breakdownArcs[o].attr({path:v,"stroke-opacity":.2*t.alpha,"fill-opacity":t.breakdownOpacities[o]*t.alpha})}}t.label.show(),t.label.css({width:2*e+"px",height:2*e+"px",opacity:1}),t.label.css({left:t.pos.x-e+"px",top:t.pos.y-e+"px"})}},this.hide=function(){var t,e=this;e.circle.remove(),e.dashedBorder.remove(),e.label.remove(),e.label2.remove(),e.visible=!1;for(t in e.breakdownArcs)e.breakdownArcs[t].remove()},h.show=function(){var e,n=this,i=Math.max(5,n.bubbleRad*n.bc.bubbleScale),r={stroke:!1};n.icon?r["fill-opacity"]=0:r.fill=n.color,n.circle=n.paper.circle(n.pos.x,n.pos.y,i).attr(r),$.isFunction(n.bc.config.initTooltip)&&n.bc.config.initTooltip(n.node,n.circle.node),n.dashedBorder=n.paper.circle(n.pos.x,n.pos.y,1.05*i).attr({stroke:n.node.stroke,"stroke-opacity":1,fill:!1,class:"dashed"});var o='<div class="desc">'+n.node.shortLabel+"</div>";if(n.node.icon&&(o+='<div class="icon-container"><img class="smooth node-img-'+n.node.id+'" src="'+n.node.icon+'"></div>'),n.node.images&&n.node.images.length){o+='<div class="images">';for(var e=0;e<n.node.images.length;e++){var s=t.images[e];o+='<img src="'+s+'" alt="profile">'}o+="</div>"}var a,h=n.node.icon?"transparent":n.color;n.node.detail&&!n.node.icon&&(a='<div class="card label '+n.node.id+'" > <div class="front" style="background: '+h+';">'+n.node.shortLabel+'</div> <div class="back" style="background: white; color: black;">'+n.node.detailContent+"</div> </div>");var l=a?a:'<div class="label '+n.node.id+(n.node.icon?" iconized ":"")+'" style="background:'+h+'">'+o+"</div>";n.label=$(l),n.node.detail&&!n.node.icon&&(n.label.flip({trigger:"manual"}),n.label.on("click",function(t){n.label.hasClass("current")&&$("."+n.node.id).flip("toggle")})),n.node.clazz&&n.label.addClass(n.node.clazz),n.bc.$container.append(n.label);var c=n.node;l=$(".label."+c.id),n.node.droppable&&n.enableDrop(c),c.timeProgress&&c.timeProgress<1&&(c.timeProgressBar&&c.timeProgressBar.destroy(),l.length&&(c.timeProgressBar=factory.build(l.get(0),"#009ddc","easeIn",c.timeProgress))),n.node.children.length>1&&($(n.circle.node).css({cursor:"pointer"}),$(n.label).css({cursor:"pointer"})),n.label2=$('<div class="label2 '+n.node.id+'"><span>'+n.node.shortLabel+"</span></div>"),n.bc.$container.append(n.label2);var u=[n.circle.node,n.label];if(n.breakdown.length>1){n.breakdownArcs={};for(e in n.breakdown){var b=n.breakdownColors[e]?n.breakdownColors[e]:"#fff",d=n.paper.path("M 0 0 L 2 2").attr({fill:b,"fill-opacity":.4*Math.random()+.3,stroke:"#fff"});n.breakdownArcs[e]=d,$.isFunction(n.bc.config.initTooltip)&&n.bc.config.initTooltip(n.node.breakdowns[e],d.node)}for(e in n.breakdownArcs)$(n.breakdownArcs[e].node).click(n.onclick.bind(n))}var f=new n.ns.MouseEventGroup(n,u);f.click(n.onclick.bind(n)),f.hover(n.onhover.bind(n)),f.unhover(n.onunhover.bind(n)),n.visible=!0},h.enableDrop=function(t){console.log("Enabling drop");var e=$(".label."+t.id),n=this;e.attr("drop","true"),e.addClass("droppable"),e.off("dragover"),e.off("dragleave"),e.off("dropover"),e.off("drop"),e.droppable({over:function(t,n){e.addClass("dragover")},out:function(t,n){e.removeClass("dragover")}}),e.on("dragover",function(t){t.stopPropagation(),t.preventDefault(),e.addClass("dragover")}),e.on("dragleave",function(t,n,i){t.stopPropagation(),t.preventDefault(),console.log("Dragging leave"),e.removeClass("dragover")}),e.on("drop",function(i,r,o){i.stopPropagation(),i.preventDefault(),e.removeClass("dragover"),n.bc.config.handleDrop(i,t)})},h.arcHover=function(t){var e,n=this,i=n.bc.$container[0],r=n.breakdownArcs,o=n.node.breakdowns;for(e in r)if(r[e].node==t.target)return t.node=o[e],t.bubblePos={x:n.pos.x,y:n.pos.y},t.mousePos={x:t.pageX-i.offsetLeft,y:t.pageY-i.offsetTop},t.target=n,t.type="SHOW",void n.bc.tooltip(t);vis4.log("cant find the breakdown node")},h.arcUnhover=function(t){var e,n=this,i=n.bc.$container[0],r=n.breakdownArcs,o=n.node.breakdowns;for(e in r)if(r[e].node==t.target)return t.node=o[e],t.bubblePos={x:n.pos.x,y:n.pos.y},t.mousePos={x:t.pageX-i.offsetLeft,y:t.pageY-i.offsetTop},t.type="HIDE",t.target=n,void n.bc.tooltip(t);vis4.log("cant find the breakdown node")},h.init()},BubbleTree.Bubbles=BubbleTree.Bubbles||{};