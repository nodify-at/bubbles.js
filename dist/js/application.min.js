"use strict";!function(){function t(t,e){function r(r,i,n){var a,o={enableDrop:r.enableDrop,handleDrop:r.handleDrop,enableFlip:r.enableFlip,disableNavigationSingleNode:r.disableNavigationSingleNode,scaleFactor:r.scaleFactor,ready:function(t){},navigateTo:r.navigateTo,onClick:function(t){"function"==typeof r.nodeSelected&&r.nodeSelected(t),t.clickCount=t.clickCount?t.clickCount+1:1,t.detail}},s=$(".bubbletree").get(0);r.$watch("data",function(i,n){if(i!==n&&!a){var l=t.parse(r.data);a=e.build(l,s,o)}},!0)}return{restrict:"A",scope:{nodeSelected:"=",navigateTo:"=",data:"=",scaleFactor:"@",disableNavigationSingleNode:"@",enableDrop:"@",enableFlip:"@",handleDrop:"="},link:r}}var e=angular.module("tribefire.bubble",[]);e.directive("tribefireBubble",t),t.$inject=["DataParser","BubbleTreeFactory"]}(),function(){function t(){function t(t,e,r){var i={};return i.enableDrop=r.enableDrop,i.handleDrop=r.handleDrop,i.enableFlip=r.enableFlip,i.disableNavigationSingleNode=r.disableNavigationSingleNode,i.data=t,i.container=e,i.bubbleType="donut",i.scaleFactor=r.scaleFactor,i.ready=function(e,i){$(".amount").remove(),r.ready(t)},i.navigateTo=r.navigateTo,i.onClick=r.onClick,i.rootPath="./",new BubbleTree(i)}return{build:t}}var e=angular.module("tribefire.bubble");e.factory("BubbleTreeFactory",t)}(),!function(t){"function"==typeof define&&define.amd?define(["jquery"],function(e){return t(e)}):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery")):t(window.jQuery)}(function(t){function e(t){void 0===t&&(t=window.navigator.userAgent),t=t.toLowerCase();var e=/(edge)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],r=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(silk)/.exec(t)||/(android)/.exec(t)||/(windows phone)/.exec(t)||/(win)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||/(playbook)/.exec(t)||/(bb)/.exec(t)||/(blackberry)/.exec(t)||[],i={},n={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",versionNumber:e[4]||e[2]||"0",platform:r[0]||""};if(n.browser&&(i[n.browser]=!0,i.version=n.version,i.versionNumber=parseInt(n.versionNumber,10)),n.platform&&(i[n.platform]=!0),(i.android||i.bb||i.blackberry||i.ipad||i.iphone||i.ipod||i.kindle||i.playbook||i.silk||i["windows phone"])&&(i.mobile=!0),(i.cros||i.mac||i.linux||i.win)&&(i.desktop=!0),(i.chrome||i.opr||i.safari)&&(i.webkit=!0),i.rv||i.edge){var a="msie";n.browser=a,i[a]=!0}if(i.safari&&i.blackberry){var o="blackberry";n.browser=o,i[o]=!0}if(i.safari&&i.playbook){var s="playbook";n.browser=s,i[s]=!0}if(i.bb){var l="blackberry";n.browser=l,i[l]=!0}if(i.opr){var c="opera";n.browser=c,i[c]=!0}if(i.safari&&i.android){var h="android";n.browser=h,i[h]=!0}if(i.safari&&i.kindle){var u="kindle";n.browser=u,i[u]=!0}if(i.safari&&i.silk){var f="silk";n.browser=f,i[f]=!0}return i.name=n.browser,i.platform=n.platform,i}return window.jQBrowser=e(window.navigator.userAgent),window.jQBrowser.uaMatch=e,t&&(t.browser=window.jQBrowser),window.jQBrowser}),function(){function t(){if(t.is(arguments[0],W)){for(var e=arguments[0],r=Qt[y](t,e.splice(0,3+t.is(e[0],j))),i=r.set(),n=0,a=e[N];n<a;n++){var o=e[n]||{};c[f](o.type)&&i[z](r[o.type]().attr(o))}return i}return Qt[y](t,arguments)}function e(){for(var t=[],e=0;e<32;e++)t[e]=(~~(16*$.random()))[D](16);return t[12]=4,t[16]=(3&t[16]|8)[D](16),"r-"+t[M]("")}function r(t,e,r){function i(){var n=Array[u].slice.call(arguments,0),a=n[M]("►"),o=i.cache=i.cache||{},s=i.count=i.count||[];return o[f](a)?r?r(o[a]):o[a]:(s[N]>=1e3&&delete o[s.shift()],s[z](a),o[a]=t[y](e,n),r?r(o[a]):o[a])}return i}function i(e,r,i,n,a){return a?t.format("M{0},{1}l{2},0a{3},{3},0,0,1,{3},{3}l0,{5}a{3},{3},0,0,1,{4},{3}l{6},0a{3},{3},0,0,1,{4},{4}l0,{7}a{3},{3},0,0,1,{3},{4}z",e+a,r,i-2*a,a,-a,n-2*a,2*a-i,2*a-n):t.format("M{0},{1}l{2},0,0,{3},{4},0z",e,r,i,n,-i)}function n(){return this.x+k+this.y}function a(e){return function(r,i,n,a){var o={back:e};return t.is(n,"function")?a=n:o.rot=n,r&&r.constructor==zt&&(r=r.attrs.path),r&&(o.along=r),this.animate(o,i,a)}}function o(t,e,r,i,n,a){function o(t){return((u*t+h)*t+c)*t}function s(t,e){var r=l(t,e);return((p*r+d)*r+f)*r}function l(t,e){var r,i,n,a,s,l;for(n=t,l=0;l<8;l++){if(a=o(n)-t,P(a)<e)return n;if(s=(3*u*n+2*h)*n+c,P(s)<1e-6)break;n-=a/s}if(r=0,i=1,n=t,n<r)return r;if(n>i)return i;for(;r<i;){if(a=o(n),P(a-t)<e)return n;t>a?r=n:i=n,n=(i-r)/2+r}return n}var c=3*e,h=3*(i-e)-c,u=1-c-h,f=3*r,d=3*(n-r)-f,p=1-f-d;return s(t,1/(200*a))}t.version="1.5.2";var s,l=/[, ]+/,c={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},h=/\{(\d+)\}/g,u="prototype",f="hasOwnProperty",d=document,p=window,b={was:Object[u][f].call(p,"Raphael"),is:p.Raphael},v=function(){this.customAttributes={}},g="appendChild",y="apply",m="concat",x="createTouch"in d,w="",k=" ",E=String,T="split",B="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend orientationchange touchcancel gesturestart gesturechange gestureend"[T](k),C={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},M="join",N="length",A=E[u].toLowerCase,$=Math,_=$.max,O=$.min,P=$.abs,S=$.pow,R=$.PI,j="number",L="string",W="array",D="toString",I="fill",F=Object[u][D],z="push",G=/^url\(['"]?([^\)]+?)['"]?\)$/i,H=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,U={NaN:1,Infinity:1,"-Infinity":1},q=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,V=$.round,Y="setAttribute",X=parseFloat,Q=parseInt,Z=" progid:DXImageTransform.Microsoft",J=E[u].toUpperCase,K={blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rotation:0,rx:0,ry:0,scale:"1 1",src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",translation:"0 0",width:0,x:0,y:0},tt={along:"along",blur:j,"clip-rect":"csv",cx:j,cy:j,fill:"colour","fill-opacity":j,"font-size":j,height:j,opacity:j,path:"path",r:j,rotation:"csv",rx:j,ry:j,scale:"csv",stroke:"colour","stroke-opacity":j,"stroke-width":j,translation:"csv",width:j,x:j,y:j},et="replace",rt=/^(from|to|\d+%?)$/,it=/\s*,\s*/,nt={hs:1,rg:1},at=/,?([achlmqrstvxz]),?/gi,ot=/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/gi,st=/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/gi,lt=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/,ct=function(t,e){return t.key-e.key};if(t.type=p.SVGAngle||d.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==t.type){var ht,ut=d.createElement("div");if(ut.innerHTML='<v:shape adj="1"/>',ht=ut.firstChild,ht.style.behavior="url(#default#VML)",!ht||"object"!=typeof ht.adj)return t.type=null;ut=null}t.svg=!(t.vml="VML"==t.type),v[u]=t[u],s=v[u],t._id=0,t._oid=0,t.fn={},t.is=function(t,e){return e=A.call(e),"finite"==e?!U[f](+t):"null"==e&&null===t||e==typeof t||"object"==e&&t===Object(t)||"array"==e&&Array.isArray&&Array.isArray(t)||F.call(t).slice(8,-1).toLowerCase()==e},t.angle=function(e,r,i,n,a,o){if(null==a){var s=e-i,l=r-n;return s||l?(180*(s<0)+180*$.atan(-l/-s)/R+360)%360:0}return t.angle(e,r,a,o)-t.angle(i,n,a,o)},t.rad=function(t){return t%360*R/180},t.deg=function(t){return 180*t/R%360},t.snapTo=function(e,r,i){if(i=t.is(i,"finite")?i:10,t.is(e,W)){for(var n=e.length;n--;)if(P(e[n]-r)<=i)return e[n]}else{e=+e;var a=r%e;if(a<i)return r-a;if(a>e-i)return r-a+e}return r},t.setWindow=function(t){p=t,d=p.document};var ft=function(e){if(t.vml){var i,n=/^\s+|\s+$/g;try{var a=new ActiveXObject("htmlfile");a.write("<body>"),a.close(),i=a.body}catch(t){i=createPopup().document.body}var o=i.createTextRange();ft=r(function(t){try{i.style.color=E(t)[et](n,w);var e=o.queryCommandValue("ForeColor");return e=(255&e)<<16|65280&e|(16711680&e)>>>16,"#"+("000000"+e[D](16)).slice(-6)}catch(t){return"none"}})}else{var s=d.createElement("i");s.title="Raphaël Colour Picker",s.style.display="none",d.body[g](s),ft=r(function(t){return s.style.color=t,d.defaultView.getComputedStyle(s,w).getPropertyValue("color")})}return ft(e)},dt=function(){return"hsb("+[this.h,this.s,this.b]+")"},pt=function(){return"hsl("+[this.h,this.s,this.l]+")"},bt=function(){return this.hex};t.hsb2rgb=function(e,r,i,n){return t.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(i=e.b,r=e.s,e=e.h,n=e.o),t.hsl2rgb(e,r,i/2,n)},t.hsl2rgb=function(e,r,i,n){t.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(i=e.l,r=e.s,e=e.h),(e>1||r>1||i>1)&&(e/=360,r/=100,i/=100);var a,o,s,l={},c=["r","g","b"];if(r){a=i<.5?i*(1+r):i+r-i*r,o=2*i-a;for(var h=0;h<3;h++)s=e+1/3*-(h-1),s<0&&s++,s>1&&s--,6*s<1?l[c[h]]=o+6*(a-o)*s:2*s<1?l[c[h]]=a:3*s<2?l[c[h]]=o+(a-o)*(2/3-s)*6:l[c[h]]=o}else l={r:i,g:i,b:i};return l.r*=255,l.g*=255,l.b*=255,l.hex="#"+(16777216|l.b|l.g<<8|l.r<<16).toString(16).slice(1),t.is(n,"finite")&&(l.opacity=n),l.toString=bt,l},t.rgb2hsb=function(e,r,i){if(null==r&&t.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(i=e.b,r=e.g,e=e.r),null==r&&t.is(e,L)){var n=t.getRGB(e);e=n.r,r=n.g,i=n.b}(e>1||r>1||i>1)&&(e/=255,r/=255,i/=255);var a,o,s=_(e,r,i),l=O(e,r,i),c=s;if(l==s)return{h:0,s:0,b:s,toString:dt};var h=s-l;return o=h/s,a=e==s?(r-i)/h:r==s?2+(i-e)/h:4+(e-r)/h,a/=6,a<0&&a++,a>1&&a--,{h:a,s:o,b:c,toString:dt}},t.rgb2hsl=function(e,r,i){if(null==r&&t.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(i=e.b,r=e.g,e=e.r),null==r&&t.is(e,L)){var n=t.getRGB(e);e=n.r,r=n.g,i=n.b}(e>1||r>1||i>1)&&(e/=255,r/=255,i/=255);var a,o,s,l=_(e,r,i),c=O(e,r,i),h=(l+c)/2;if(c==l)s={h:0,s:0,l:h};else{var u=l-c;o=h<.5?u/(l+c):u/(2-l-c),a=e==l?(r-i)/u:r==l?2+(i-e)/u:4+(e-r)/u,a/=6,a<0&&a++,a>1&&a--,s={h:a,s:o,l:h}}return s.toString=pt,s},t._path2string=function(){return this.join(",")[et](at,"$1")},t.getRGB=r(function(e){if(!e||(e=E(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1};if("none"==e)return{r:-1,g:-1,b:-1,hex:"none"};!(nt[f](e.toLowerCase().substring(0,2))||"#"==e.charAt())&&(e=ft(e));var r,i,n,a,o,s,l=e.match(H);return l?(l[2]&&(n=Q(l[2].substring(5),16),i=Q(l[2].substring(3,5),16),r=Q(l[2].substring(1,3),16)),l[3]&&(n=Q((o=l[3].charAt(3))+o,16),i=Q((o=l[3].charAt(2))+o,16),r=Q((o=l[3].charAt(1))+o,16)),l[4]&&(s=l[4][T](it),r=X(s[0]),"%"==s[0].slice(-1)&&(r*=2.55),i=X(s[1]),"%"==s[1].slice(-1)&&(i*=2.55),n=X(s[2]),"%"==s[2].slice(-1)&&(n*=2.55),"rgba"==l[1].toLowerCase().slice(0,4)&&(a=X(s[3])),s[3]&&"%"==s[3].slice(-1)&&(a/=100)),l[5]?(s=l[5][T](it),r=X(s[0]),"%"==s[0].slice(-1)&&(r*=2.55),i=X(s[1]),"%"==s[1].slice(-1)&&(i*=2.55),n=X(s[2]),"%"==s[2].slice(-1)&&(n*=2.55),("deg"==s[0].slice(-3)||"°"==s[0].slice(-1))&&(r/=360),"hsba"==l[1].toLowerCase().slice(0,4)&&(a=X(s[3])),s[3]&&"%"==s[3].slice(-1)&&(a/=100),t.hsb2rgb(r,i,n,a)):l[6]?(s=l[6][T](it),r=X(s[0]),"%"==s[0].slice(-1)&&(r*=2.55),i=X(s[1]),"%"==s[1].slice(-1)&&(i*=2.55),n=X(s[2]),"%"==s[2].slice(-1)&&(n*=2.55),("deg"==s[0].slice(-3)||"°"==s[0].slice(-1))&&(r/=360),"hsla"==l[1].toLowerCase().slice(0,4)&&(a=X(s[3])),s[3]&&"%"==s[3].slice(-1)&&(a/=100),t.hsl2rgb(r,i,n,a)):(l={r:r,g:i,b:n},l.hex="#"+(16777216|n|i<<8|r<<16).toString(16).slice(1),t.is(a,"finite")&&(l.opacity=a),l)):{r:-1,g:-1,b:-1,hex:"none",error:1}},t),t.getColor=function(t){var e=this.getColor.start=this.getColor.start||{h:0,s:1,b:t||.75},r=this.hsb2rgb(e.h,e.s,e.b);return e.h+=.075,e.h>1&&(e.h=0,e.s-=.2,e.s<=0&&(this.getColor.start={h:0,s:1,b:e.b})),r.hex},t.getColor.reset=function(){delete this.start},t.parsePathString=r(function(e){if(!e)return null;var r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},i=[];return t.is(e,W)&&t.is(e[0],W)&&(i=gt(e)),i[N]||E(e)[et](ot,function(t,e,n){var a=[],o=A.call(e);for(n[et](st,function(t,e){e&&a[z](+e)}),"m"==o&&a[N]>2&&(i[z]([e][m](a.splice(0,2))),o="l",e="m"==e?"l":"L");a[N]>=r[o]&&(i[z]([e][m](a.splice(0,r[o]))),r[o]););}),i[D]=t._path2string,i}),t.findDotsAtSegment=function(t,e,r,i,n,a,o,s,l){var c=1-l,h=S(c,3)*t+3*S(c,2)*l*r+3*c*l*l*n+S(l,3)*o,u=S(c,3)*e+3*S(c,2)*l*i+3*c*l*l*a+S(l,3)*s,f=t+2*l*(r-t)+l*l*(n-2*r+t),d=e+2*l*(i-e)+l*l*(a-2*i+e),p=r+2*l*(n-r)+l*l*(o-2*n+r),b=i+2*l*(a-i)+l*l*(s-2*a+i),v=(1-l)*t+l*r,g=(1-l)*e+l*i,y=(1-l)*n+l*o,m=(1-l)*a+l*s,x=90-180*$.atan((f-p)/(d-b))/R;return(f>p||d<b)&&(x+=180),{x:h,y:u,m:{x:f,y:d},n:{x:p,y:b},start:{x:v,y:g},end:{x:y,y:m},alpha:x}};var vt=r(function(t){if(!t)return{x:0,y:0,width:0,height:0};t=Bt(t);for(var e,r=0,i=0,n=[],a=[],o=0,s=t[N];o<s;o++)if(e=t[o],"M"==e[0])r=e[1],i=e[2],n[z](r),a[z](i);else{var l=Tt(r,i,e[1],e[2],e[3],e[4],e[5],e[6]);n=n[m](l.min.x,l.max.x),a=a[m](l.min.y,l.max.y),r=e[5],i=e[6]}var c=O[y](0,n),h=O[y](0,a);return{x:c,y:h,width:_[y](0,n)-c,height:_[y](0,a)-h}}),gt=function(e){var r=[];t.is(e,W)&&t.is(e&&e[0],W)||(e=t.parsePathString(e));for(var i=0,n=e[N];i<n;i++){r[i]=[];for(var a=0,o=e[i][N];a<o;a++)r[i][a]=e[i][a]}return r[D]=t._path2string,r},yt=r(function(e){t.is(e,W)&&t.is(e&&e[0],W)||(e=t.parsePathString(e));var r=[],i=0,n=0,a=0,o=0,s=0;"M"==e[0][0]&&(i=e[0][1],n=e[0][2],a=i,o=n,s++,r[z](["M",i,n]));for(var l=s,c=e[N];l<c;l++){var h=r[l]=[],u=e[l];if(u[0]!=A.call(u[0]))switch(h[0]=A.call(u[0]),h[0]){case"a":h[1]=u[1],h[2]=u[2],h[3]=u[3],h[4]=u[4],h[5]=u[5],h[6]=+(u[6]-i).toFixed(3),h[7]=+(u[7]-n).toFixed(3);break;case"v":h[1]=+(u[1]-n).toFixed(3);break;case"m":a=u[1],o=u[2];default:for(var f=1,d=u[N];f<d;f++)h[f]=+(u[f]-(f%2?i:n)).toFixed(3)}else{h=r[l]=[],"m"==u[0]&&(a=u[1]+i,o=u[2]+n);for(var p=0,b=u[N];p<b;p++)r[l][p]=u[p]}var v=r[l][N];switch(r[l][0]){case"z":i=a,n=o;break;case"h":i+=+r[l][v-1];break;case"v":n+=+r[l][v-1];break;default:i+=+r[l][v-2],n+=+r[l][v-1]}}return r[D]=t._path2string,r},0,gt),mt=r(function(e){t.is(e,W)&&t.is(e&&e[0],W)||(e=t.parsePathString(e));var r=[],i=0,n=0,a=0,o=0,s=0;"M"==e[0][0]&&(i=+e[0][1],n=+e[0][2],a=i,o=n,s++,r[0]=["M",i,n]);for(var l=s,c=e[N];l<c;l++){var h=r[l]=[],u=e[l];if(u[0]!=J.call(u[0]))switch(h[0]=J.call(u[0]),h[0]){case"A":h[1]=u[1],h[2]=u[2],h[3]=u[3],h[4]=u[4],h[5]=u[5],h[6]=+(u[6]+i),h[7]=+(u[7]+n);break;case"V":h[1]=+u[1]+n;break;case"H":h[1]=+u[1]+i;break;case"M":a=+u[1]+i,o=+u[2]+n;default:for(var f=1,d=u[N];f<d;f++)h[f]=+u[f]+(f%2?i:n)}else for(var p=0,b=u[N];p<b;p++)r[l][p]=u[p];switch(h[0]){case"Z":i=a,n=o;break;case"H":i=h[1];break;case"V":n=h[1];break;case"M":a=r[l][r[l][N]-2],o=r[l][r[l][N]-1];default:i=r[l][r[l][N]-2],n=r[l][r[l][N]-1]}}return r[D]=t._path2string,r},null,gt),xt=function(t,e,r,i){return[t,e,r,i,r,i]},wt=function(t,e,r,i,n,a){var o=1/3,s=2/3;return[o*t+s*r,o*e+s*i,o*n+s*r,o*a+s*i,n,a]},kt=function(t,e,i,n,a,o,s,l,c,h){var u,f=120*R/180,d=R/180*(+a||0),p=[],b=r(function(t,e,r){var i=t*$.cos(r)-e*$.sin(r),n=t*$.sin(r)+e*$.cos(r);return{x:i,y:n}});if(h)C=h[0],A=h[1],E=h[2],B=h[3];else{u=b(t,e,-d),t=u.x,e=u.y,u=b(l,c,-d),l=u.x,c=u.y;var v=($.cos(R/180*a),$.sin(R/180*a),(t-l)/2),g=(e-c)/2,y=v*v/(i*i)+g*g/(n*n);y>1&&(y=$.sqrt(y),i=y*i,n=y*n);var x=i*i,w=n*n,k=(o==s?-1:1)*$.sqrt(P((x*w-x*g*g-w*v*v)/(x*g*g+w*v*v))),E=k*i*g/n+(t+l)/2,B=k*-n*v/i+(e+c)/2,C=$.asin(((e-B)/n).toFixed(9)),A=$.asin(((c-B)/n).toFixed(9));C=t<E?R-C:C,A=l<E?R-A:A,C<0&&(C=2*R+C),A<0&&(A=2*R+A),s&&C>A&&(C-=2*R),!s&&A>C&&(A-=2*R)}var _=A-C;if(P(_)>f){var O=A,S=l,j=c;A=C+f*(s&&A>C?1:-1),l=E+i*$.cos(A),c=B+n*$.sin(A),p=kt(l,c,i,n,a,0,s,S,j,[A,O,E,B])}_=A-C;var L=$.cos(C),W=$.sin(C),D=$.cos(A),I=$.sin(A),F=$.tan(_/4),z=4/3*i*F,G=4/3*n*F,H=[t,e],U=[t+z*W,e-G*L],q=[l+z*I,c-G*D],V=[l,c];if(U[0]=2*H[0]-U[0],U[1]=2*H[1]-U[1],h)return[U,q,V][m](p);p=[U,q,V][m](p)[M]()[T](",");for(var Y=[],X=0,Q=p[N];X<Q;X++)Y[X]=X%2?b(p[X-1],p[X],d).y:b(p[X],p[X+1],d).x;return Y},Et=function(t,e,r,i,n,a,o,s,l){var c=1-l;return{x:S(c,3)*t+3*S(c,2)*l*r+3*c*l*l*n+S(l,3)*o,y:S(c,3)*e+3*S(c,2)*l*i+3*c*l*l*a+S(l,3)*s}},Tt=r(function(t,e,r,i,n,a,o,s){var l,c=n-2*r+t-(o-2*n+r),h=2*(r-t)-2*(n-r),u=t-r,f=(-h+$.sqrt(h*h-4*c*u))/2/c,d=(-h-$.sqrt(h*h-4*c*u))/2/c,p=[e,s],b=[t,o];return P(f)>"1e12"&&(f=.5),P(d)>"1e12"&&(d=.5),f>0&&f<1&&(l=Et(t,e,r,i,n,a,o,s,f),b[z](l.x),p[z](l.y)),d>0&&d<1&&(l=Et(t,e,r,i,n,a,o,s,d),b[z](l.x),p[z](l.y)),c=a-2*i+e-(s-2*a+i),h=2*(i-e)-2*(a-i),u=e-i,f=(-h+$.sqrt(h*h-4*c*u))/2/c,d=(-h-$.sqrt(h*h-4*c*u))/2/c,P(f)>"1e12"&&(f=.5),P(d)>"1e12"&&(d=.5),f>0&&f<1&&(l=Et(t,e,r,i,n,a,o,s,f),b[z](l.x),p[z](l.y)),d>0&&d<1&&(l=Et(t,e,r,i,n,a,o,s,d),b[z](l.x),p[z](l.y)),{min:{x:O[y](0,b),y:O[y](0,p)},max:{x:_[y](0,b),y:_[y](0,p)}}}),Bt=r(function(t,e){for(var r=mt(t),i=e&&mt(e),n={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=(function(t,e){var r,i;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"][m](kt[y](0,[e.x,e.y][m](t.slice(1))));break;case"S":r=e.x+(e.x-(e.bx||e.x)),i=e.y+(e.y-(e.by||e.y)),t=["C",r,i][m](t.slice(1));break;case"T":e.qx=e.x+(e.x-(e.qx||e.x)),e.qy=e.y+(e.y-(e.qy||e.y)),t=["C"][m](wt(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"][m](wt(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"][m](xt(e.x,e.y,t[1],t[2]));break;case"H":t=["C"][m](xt(e.x,e.y,t[1],e.y));break;case"V":t=["C"][m](xt(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"][m](xt(e.x,e.y,e.X,e.Y))}return t}),s=function(t,e){if(t[e][N]>7){t[e].shift();for(var n=t[e];n[N];)t.splice(e++,0,["C"][m](n.splice(0,6)));t.splice(e,1),h=_(r[N],i&&i[N]||0)}},l=function(t,e,n,a,o){t&&e&&"M"==t[o][0]&&"M"!=e[o][0]&&(e.splice(o,0,["M",a.x,a.y]),n.bx=0,n.by=0,n.x=t[o][1],n.y=t[o][2],h=_(r[N],i&&i[N]||0))},c=0,h=_(r[N],i&&i[N]||0);c<h;c++){r[c]=o(r[c],n),s(r,c),i&&(i[c]=o(i[c],a)),i&&s(i,c),l(r,i,n,a,c),l(i,r,a,n,c);var u=r[c],f=i&&i[c],d=u[N],p=i&&f[N];n.x=u[d-2],n.y=u[d-1],n.bx=X(u[d-4])||n.x,n.by=X(u[d-3])||n.y,a.bx=i&&(X(f[p-4])||a.x),a.by=i&&(X(f[p-3])||a.y),a.x=i&&f[p-2],a.y=i&&f[p-1]}return i?[r,i]:r},null,gt),Ct=r(function(e){for(var r=[],i=0,n=e[N];i<n;i++){var a={},o=e[i].match(/^([^:]*):?([\d\.]*)/);if(a.color=t.getRGB(o[1]),a.color.error)return null;a.color=a.color.hex,o[2]&&(a.offset=o[2]+"%"),r[z](a)}for(i=1,n=r[N]-1;i<n;i++)if(!r[i].offset){for(var s=X(r[i-1].offset||0),l=0,c=i+1;c<n;c++)if(r[c].offset){l=r[c].offset;break}l||(l=100,c=n),l=X(l);for(var h=(l-s)/(c-i+1);i<c;i++)s+=h,r[i].offset=s+"%"}return r}),Mt=function(e,r,i,n){var a;return t.is(e,L)||t.is(e,"object")?(a=t.is(e,L)?d.getElementById(e):e,a.tagName?null==r?{container:a,width:a.style.pixelWidth||a.offsetWidth,height:a.style.pixelHeight||a.offsetHeight}:{container:a,width:r,height:i}:void 0):{container:1,x:e,y:r,width:i,height:n}},Nt=function(t,e){var r=this;for(var i in e)if(e[f](i)&&!(i in t))switch(typeof e[i]){case"function":!function(e){t[i]=t===r?e:function(){return e[y](r,arguments)}}(e[i]);break;case"object":t[i]=t[i]||{},Nt.call(this,t[i],e[i]);break;default:t[i]=e[i]}},At=function(t,e){t==e.top&&(e.top=t.prev),t==e.bottom&&(e.bottom=t.next),t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next)},$t=function(t,e){e.top!==t&&(At(t,e),t.next=null,t.prev=e.top,e.top.next=t,e.top=t)},_t=function(t,e){e.bottom!==t&&(At(t,e),t.next=e.bottom,t.prev=null,e.bottom.prev=t,e.bottom=t)},Ot=function(t,e,r){At(t,r),e==r.top&&(r.top=t),e.next&&(e.next.prev=t),t.next=e.next,t.prev=e,e.next=t},Pt=function(t,e,r){At(t,r),e==r.bottom&&(r.bottom=t),e.prev&&(e.prev.next=t),t.prev=e.prev,e.prev=t,t.next=e},St=function(t){return function(){throw new Error("Raphaël: you are calling to method “"+t+"” of removed object")}};if(t.pathToRelative=yt,t.svg){s.svgns="http://www.w3.org/2000/svg",s.xlink="http://www.w3.org/1999/xlink",V=function(t){return+t+.5*(~~t===t)};var Rt=function(t,e){if(!e)return t=d.createElementNS(s.svgns,t),t.style.webkitTapHighlightColor="rgba(0,0,0,0)",t;for(var r in e)e[f](r)&&t[Y](r,E(e[r]))};t[D]=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var jt=function(t,e){var r=Rt("path");e.canvas&&e.canvas[g](r);var i=new zt(r,e);return i.type="path",Dt(i,{fill:"none",stroke:"#000",path:t}),i},Lt=function(t,r,i){var n="linear",a=.5,o=.5,s=t.style;if(r=E(r)[et](lt,function(t,e,r){if(n="radial",e&&r){a=X(e),o=X(r);var i=2*(o>.5)-1;S(a-.5,2)+S(o-.5,2)>.25&&(o=$.sqrt(.25-S(a-.5,2))*i+.5)&&.5!=o&&(o=o.toFixed(5)-1e-5*i)}return w}),r=r[T](/\s*\-\s*/),"linear"==n){var l=r.shift();if(l=-X(l),isNaN(l))return null;var c=[0,0,$.cos(l*R/180),$.sin(l*R/180)],h=1/(_(P(c[2]),P(c[3]))||1);c[2]*=h,c[3]*=h,c[2]<0&&(c[0]=-c[2],c[2]=0),c[3]<0&&(c[1]=-c[3],c[3]=0)}var u=Ct(r);if(!u)return null;var f=t.getAttribute(I);f=f.match(/^url\(#(.*)\)$/),f&&i.defs.removeChild(d.getElementById(f[1]));var p=Rt(n+"Gradient");p.id=e(),Rt(p,"radial"==n?{fx:a,fy:o}:{x1:c[0],y1:c[1],x2:c[2],y2:c[3]}),i.defs[g](p);for(var b=0,v=u[N];b<v;b++){var y=Rt("stop");Rt(y,{offset:u[b].offset?u[b].offset:b?"100%":"0%","stop-color":u[b].color||"#fff"}),p[g](y)}return Rt(t,{fill:"url(#"+p.id+")",opacity:1,"fill-opacity":1}),s.fill=w,s.opacity=1,s.fillOpacity=1,1},Wt=function(e){var r=e.getBBox();Rt(e.pattern,{patternTransform:t.format("translate({0},{1})",r.x,r.y)})},Dt=function(r,i){var n={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},a=r.node,o=r.attrs,s=r.rotate(),c=function(t,e){if(e=n[A.call(e)]){for(var r=t.attrs["stroke-width"]||"1",o={round:r,square:r,butt:0}[t.attrs["stroke-linecap"]||i["stroke-linecap"]]||0,s=[],l=e[N];l--;)s[l]=e[l]*r+(l%2?1:-1)*o;Rt(a,{"stroke-dasharray":s[M](",")})}};i[f]("rotation")&&(s=i.rotation);var h=E(s)[T](l);h.length-1?(h[1]=+h[1],h[2]=+h[2]):h=null,X(s)&&r.rotate(0,!0);for(var u in i)if(i[f](u)){if(!K[f](u))continue;var p=i[u];switch(o[u]=p,u){case"blur":r.blur(p);break;case"rotation":r.rotate(p,!0);break;case"href":case"title":case"target":var b=a.parentNode;if("a"!=A.call(b.tagName)){var v=Rt("a");b.insertBefore(v,a),v[g](a),b=v}"target"==u&&"blank"==p?b.setAttributeNS(r.paper.xlink,"show","new"):b.setAttributeNS(r.paper.xlink,u,p);break;case"cursor":a.style.cursor=p;break;case"clip-rect":var y=E(p)[T](l);if(4==y[N]){r.clip&&r.clip.parentNode.parentNode.removeChild(r.clip.parentNode);var m=Rt("clipPath"),x=Rt("rect");m.id=e(),Rt(x,{x:y[0],y:y[1],width:y[2],height:y[3]}),m[g](x),r.paper.defs[g](m),Rt(a,{"clip-path":"url(#"+m.id+")"}),r.clip=x}if(!p){var B=d.getElementById(a.getAttribute("clip-path")[et](/(^url\(#|\)$)/g,w));B&&B.parentNode.removeChild(B),Rt(a,{"clip-path":w}),delete r.clip}break;case"path":"path"==r.type&&Rt(a,{d:p?o.path=mt(p):"M0,0"});break;case"width":if(a[Y](u,p),!o.fx)break;u="x",p=o.x;case"x":o.fx&&(p=-o.x-(o.width||0));case"rx":if("rx"==u&&"rect"==r.type)break;case"cx":h&&("x"==u||"cx"==u)&&(h[1]+=p-o[u]),a[Y](u,p),r.pattern&&Wt(r);break;case"height":if(a[Y](u,p),!o.fy)break;u="y",p=o.y;case"y":o.fy&&(p=-o.y-(o.height||0));case"ry":if("ry"==u&&"rect"==r.type)break;case"cy":h&&("y"==u||"cy"==u)&&(h[2]+=p-o[u]),a[Y](u,p),r.pattern&&Wt(r);break;case"r":"rect"==r.type?Rt(a,{rx:p,ry:p}):a[Y](u,p);break;case"src":"image"==r.type&&a.setAttributeNS(r.paper.xlink,"href",p);break;case"stroke-width":a.style.strokeWidth=p,a[Y](u,p),o["stroke-dasharray"]&&c(r,o["stroke-dasharray"]);break;case"stroke-dasharray":c(r,p);break;case"translation":var C=E(p)[T](l);C[0]=+C[0]||0,C[1]=+C[1]||0,h&&(h[1]+=C[0],h[2]+=C[1]),Ce.call(r,C[0],C[1]);break;case"scale":C=E(p)[T](l),r.scale(+C[0]||1,+C[1]||+C[0]||1,isNaN(X(C[2]))?null:+C[2],isNaN(X(C[3]))?null:+C[3]);break;case I:var $=E(p).match(G);if($){m=Rt("pattern");var _=Rt("image");m.id=e(),Rt(m,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),Rt(_,{x:0,y:0}),_.setAttributeNS(r.paper.xlink,"href",$[1]),m[g](_);var O=d.createElement("img");O.style.cssText="position:absolute;left:-9999em;top-9999em",O.onload=function(){Rt(m,{width:this.offsetWidth,height:this.offsetHeight}),Rt(_,{width:this.offsetWidth,height:this.offsetHeight}),d.body.removeChild(this),r.paper.safari()},d.body[g](O),O.src=$[1],r.paper.defs[g](m),a.style.fill="url(#"+m.id+")",Rt(a,{fill:"url(#"+m.id+")"}),r.pattern=m,r.pattern&&Wt(r);break}var P=t.getRGB(p);if(P.error){if(({circle:1,ellipse:1}[f](r.type)||"r"!=E(p).charAt())&&Lt(a,p,r.paper)){o.gradient=p,o.fill="none";break}delete i.gradient,delete o.gradient,!t.is(o.opacity,"undefined")&&t.is(i.opacity,"undefined")&&Rt(a,{opacity:o.opacity}),!t.is(o["fill-opacity"],"undefined")&&t.is(i["fill-opacity"],"undefined")&&Rt(a,{"fill-opacity":o["fill-opacity"]})}P[f]("opacity")&&Rt(a,{"fill-opacity":P.opacity>1?P.opacity/100:P.opacity});case"stroke":P=t.getRGB(p),a[Y](u,P.hex),"stroke"==u&&P[f]("opacity")&&Rt(a,{"stroke-opacity":P.opacity>1?P.opacity/100:P.opacity});break;case"gradient":(({circle:1,ellipse:1})[f](r.type)||"r"!=E(p).charAt())&&Lt(a,p,r.paper);break;case"opacity":o.gradient&&!o[f]("stroke-opacity")&&Rt(a,{"stroke-opacity":p>1?p/100:p});case"fill-opacity":if(o.gradient){var S=d.getElementById(a.getAttribute(I)[et](/^url\(#|\)$/g,w));if(S){var R=S.getElementsByTagName("stop");R[R[N]-1][Y]("stop-opacity",p)}break}default:"font-size"==u&&(p=Q(p,10)+"px");var j=u[et](/(\-.)/g,function(t){return J.call(t.substring(1))});a.style[j]=p,a[Y](u,p)}}Ft(r,i),h?r.rotate(h.join(k)):X(s)&&r.rotate(s,!0)},It=1.2,Ft=function(e,r){if("text"==e.type&&(r[f]("text")||r[f]("font")||r[f]("font-size")||r[f]("x")||r[f]("y"))){var i=e.attrs,n=e.node,a=n.firstChild?Q(d.defaultView.getComputedStyle(n.firstChild,w).getPropertyValue("font-size"),10):10;if(r[f]("text")){for(i.text=r.text;n.firstChild;)n.removeChild(n.firstChild);for(var o=E(r.text)[T]("\n"),s=0,l=o[N];s<l;s++)if(o[s]){var c=Rt("tspan");s&&Rt(c,{dy:a*It,x:i.x}),c[g](d.createTextNode(o[s])),n[g](c)}}else for(o=n.getElementsByTagName("tspan"),s=0,l=o[N];s<l;s++)s&&Rt(o[s],{dy:a*It,x:i.x});Rt(n,{y:i.y});var h=e.getBBox(),u=i.y-(h.y+h.height/2);u&&t.is(u,"finite")&&Rt(n,{y:i.y+u})}},zt=function(e,r){this[0]=e,this.id=t._oid++,this.node=e,e.raphael=this,this.paper=r,this.attrs=this.attrs||{},this.transformations=[],this._={tx:0,ty:0,rt:{deg:0,cx:0,cy:0},sx:1,sy:1},!r.bottom&&(r.bottom=this),this.prev=r.top,r.top&&(r.top.next=this),r.top=this,this.next=null},Gt=zt[u];zt[u].rotate=function(e,r,i){if(this.removed)return this;if(null==e)return this._.rt.cx?[this._.rt.deg,this._.rt.cx,this._.rt.cy][M](k):this._.rt.deg;var n=this.getBBox();return e=E(e)[T](l),e[N]-1&&(r=X(e[1]),i=X(e[2])),e=X(e[0]),null!=r&&r!==!1?this._.rt.deg=e:this._.rt.deg+=e,null==i&&(r=null),this._.rt.cx=r,this._.rt.cy=i,r=null==r?n.x+n.width/2:r,i=null==i?n.y+n.height/2:i,this._.rt.deg?(this.transformations[0]=t.format("rotate({0} {1} {2})",this._.rt.deg,r,i),this.clip&&Rt(this.clip,{transform:t.format("rotate({0} {1} {2})",-this._.rt.deg,r,i)})):(this.transformations[0]=w,this.clip&&Rt(this.clip,{transform:w})),Rt(this.node,{transform:this.transformations[M](k)}),this},zt[u].hide=function(){return!this.removed&&(this.node.style.display="none"),this},zt[u].show=function(){return!this.removed&&(this.node.style.display=""),this},zt[u].remove=function(){if(!this.removed){At(this,this.paper),this.node.parentNode.removeChild(this.node);for(var t in this)delete this[t];this.removed=!0}},zt[u].getBBox=function(){if(this.removed)return this;if("path"==this.type)return vt(this.attrs.path);if("none"==this.node.style.display){this.show();var t=!0}var e={};try{e=this.node.getBBox()}catch(t){}finally{e=e||{}}if("text"==this.type){e={x:e.x,y:1/0,width:0,height:0};for(var r=0,i=this.node.getNumberOfChars();r<i;r++){var n=this.node.getExtentOfChar(r);n.y<e.y&&(e.y=n.y),n.y+n.height-e.y>e.height&&(e.height=n.y+n.height-e.y),n.x+n.width-e.x>e.width&&(e.width=n.x+n.width-e.x)}}return t&&this.hide(),e},zt[u].attr=function(e,r){if(this.removed)return this;if(null==e){var i={};for(var n in this.attrs)this.attrs[f](n)&&(i[n]=this.attrs[n]);return this._.rt.deg&&(i.rotation=this.rotate()),(1!=this._.sx||1!=this._.sy)&&(i.scale=this.scale()),i.gradient&&"none"==i.fill&&(i.fill=i.gradient)&&delete i.gradient,i}if(null==r&&t.is(e,L))return"translation"==e?Ce.call(this):"rotation"==e?this.rotate():"scale"==e?this.scale():e==I&&"none"==this.attrs.fill&&this.attrs.gradient?this.attrs.gradient:this.attrs[e];if(null==r&&t.is(e,W)){for(var a={},o=0,s=e.length;o<s;o++)a[e[o]]=this.attr(e[o]);return a}if(null!=r){var l={};l[e]=r}else null!=e&&t.is(e,"object")&&(l=e);for(var c in this.paper.customAttributes)if(this.paper.customAttributes[f](c)&&l[f](c)&&t.is(this.paper.customAttributes[c],"function")){var h=this.paper.customAttributes[c].apply(this,[][m](l[c]));this.attrs[c]=l[c];for(var u in h)h[f](u)&&(l[u]=h[u])}return Dt(this,l),this},zt[u].toFront=function(){if(this.removed)return this;this.node.parentNode[g](this.node);var t=this.paper;return t.top!=this&&$t(this,t),this},zt[u].toBack=function(){if(this.removed)return this;if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),_t(this,this.paper);this.paper}return this},zt[u].insertAfter=function(t){if(this.removed)return this;var e=t.node||t[t.length-1].node;return e.nextSibling?e.parentNode.insertBefore(this.node,e.nextSibling):e.parentNode[g](this.node),Ot(this,t,this.paper),this},zt[u].insertBefore=function(t){if(this.removed)return this;var e=t.node||t[0].node;return e.parentNode.insertBefore(this.node,e),Pt(this,t,this.paper),this},zt[u].blur=function(t){var r=this;if(0!==+t){var i=Rt("filter"),n=Rt("feGaussianBlur");r.attrs.blur=t,i.id=e(),Rt(n,{stdDeviation:+t||1.5}),i.appendChild(n),r.paper.defs.appendChild(i),r._blur=i,Rt(r.node,{filter:"url(#"+i.id+")"})}else r._blur&&(r._blur.parentNode.removeChild(r._blur),delete r._blur,delete r.attrs.blur),r.node.removeAttribute("filter")};var Ht=function(t,e,r,i){var n=Rt("circle");t.canvas&&t.canvas[g](n);var a=new zt(n,t);return a.attrs={cx:e,cy:r,r:i,fill:"none",stroke:"#000"},a.type="circle",Rt(n,a.attrs),a},Ut=function(t,e,r,i,n,a){var o=Rt("rect");t.canvas&&t.canvas[g](o);var s=new zt(o,t);return s.attrs={x:e,y:r,width:i,height:n,r:a||0,rx:a||0,ry:a||0,fill:"none",stroke:"#000"},s.type="rect",Rt(o,s.attrs),s},qt=function(t,e,r,i,n){var a=Rt("ellipse");t.canvas&&t.canvas[g](a);var o=new zt(a,t);return o.attrs={cx:e,cy:r,rx:i,ry:n,fill:"none",stroke:"#000"},o.type="ellipse",Rt(a,o.attrs),o},Vt=function(t,e,r,i,n,a){var o=Rt("image");Rt(o,{x:r,y:i,width:n,height:a,preserveAspectRatio:"none"}),o.setAttributeNS(t.xlink,"href",e),t.canvas&&t.canvas[g](o);var s=new zt(o,t);return s.attrs={x:r,y:i,width:n,height:a,src:e},s.type="image",s},Yt=function(t,e,r,i){var n=Rt("text");Rt(n,{x:e,y:r,"text-anchor":"middle"}),t.canvas&&t.canvas[g](n);var a=new zt(n,t);return a.attrs={x:e,y:r,"text-anchor":"middle",text:i,font:K.font,stroke:"none",fill:"#000"},a.type="text",Dt(a,a.attrs),a},Xt=function(t,e){return this.width=t||this.width,this.height=e||this.height,this.canvas[Y]("width",this.width),this.canvas[Y]("height",this.height),this},Qt=function(){var e=Mt[y](0,arguments),r=e&&e.container,i=e.x,n=e.y,a=e.width,o=e.height;if(!r)throw new Error("SVG container not found.");var s=Rt("svg");return i=i||0,n=n||0,a=a||512,o=o||342,Rt(s,{xmlns:"http://www.w3.org/2000/svg",version:1.1,width:a,height:o}),1==r?(s.style.cssText="position:absolute;left:"+i+"px;top:"+n+"px",d.body[g](s)):r.firstChild?r.insertBefore(s,r.firstChild):r[g](s),r=new v,r.width=a,r.height=o,r.canvas=s,Nt.call(r,r,t.fn),r.clear(),r};s.clear=function(){for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);
this.bottom=this.top=null,(this.desc=Rt("desc"))[g](d.createTextNode("Created with Raphaël")),t[g](this.desc),t[g](this.defs=Rt("defs"))},s.remove=function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]=St(t)}}if(t.vml){var Zt={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},Jt=/([clmz]),?([^clmz]*)/gi,Kt=/ progid:\S+Blur\([^\)]+\)/g,te=/-?[^,\s-]+/g,ee=1e3+k+1e3,re=10,ie={path:1,rect:1},ne=function(t){var e=/[ahqstv]/gi,r=mt;if(E(t).match(e)&&(r=Bt),e=/[clmz]/g,r==mt&&!E(t).match(e)){var i=E(t)[et](Jt,function(t,e,r){var i=[],n="m"==A.call(e),a=Zt[e];return r[et](te,function(t){n&&2==i[N]&&(a+=i+Zt["m"==e?"l":"L"],i=[]),i[z](V(t*re))}),a+i});return i}var n,a,o=r(t);i=[];for(var s=0,l=o[N];s<l;s++){n=o[s],a=A.call(o[s][0]),"z"==a&&(a="x");for(var c=1,h=n[N];c<h;c++)a+=V(n[c]*re)+(c!=h-1?",":w);i[z](a)}return i[M](k)};t[D]=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version},jt=function(t,e){var r=ae("group");r.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px",r.coordsize=e.coordsize,r.coordorigin=e.coordorigin;var i=ae("shape"),n=i.style;n.width=e.width+"px",n.height=e.height+"px",i.coordsize=ee,i.coordorigin=e.coordorigin,r[g](i);var a=new zt(i,r,e),o={fill:"none",stroke:"#000"};return t&&(o.path=t),a.type="path",a.path=[],a.Path=w,Dt(a,o),e.canvas[g](r),a},Dt=function(e,r){e.attrs=e.attrs||{};var n,a=e.node,o=e.attrs,s=a.style,c=(r.x!=o.x||r.y!=o.y||r.width!=o.width||r.height!=o.height||r.r!=o.r)&&"rect"==e.type,h=e;for(var u in r)r[f](u)&&(o[u]=r[u]);if(c&&(o.path=i(o.x,o.y,o.width,o.height,o.r),e.X=o.x,e.Y=o.y,e.W=o.width,e.H=o.height),r.href&&(a.href=r.href),r.title&&(a.title=r.title),r.target&&(a.target=r.target),r.cursor&&(s.cursor=r.cursor),"blur"in r&&e.blur(r.blur),(r.path&&"path"==e.type||c)&&(a.path=ne(o.path)),null!=r.rotation&&e.rotate(r.rotation,!0),r.translation&&(n=E(r.translation)[T](l),Ce.call(e,n[0],n[1]),null!=e._.rt.cx&&(e._.rt.cx+=+n[0],e._.rt.cy+=+n[1],e.setBox(e.attrs,n[0],n[1]))),r.scale&&(n=E(r.scale)[T](l),e.scale(+n[0]||1,+n[1]||+n[0]||1,+n[2]||null,+n[3]||null)),"clip-rect"in r){var p=E(r["clip-rect"])[T](l);if(4==p[N]){p[2]=+p[2]+ +p[0],p[3]=+p[3]+ +p[1];var b=a.clipRect||d.createElement("div"),v=b.style,y=a.parentNode;v.clip=t.format("rect({1}px {2}px {3}px {0}px)",p),a.clipRect||(v.position="absolute",v.top=0,v.left=0,v.width=e.paper.width+"px",v.height=e.paper.height+"px",y.parentNode.insertBefore(b,y),b[g](y),a.clipRect=b)}r["clip-rect"]||a.clipRect&&(a.clipRect.style.clip=w)}if("image"==e.type&&r.src&&(a.src=r.src),"image"==e.type&&r.opacity&&(a.filterOpacity=Z+".Alpha(opacity="+100*r.opacity+")",s.filter=(a.filterMatrix||w)+(a.filterOpacity||w)),r.font&&(s.font=r.font),r["font-family"]&&(s.fontFamily='"'+r["font-family"][T](",")[0][et](/^['"]+|['"]+$/g,w)+'"'),r["font-size"]&&(s.fontSize=r["font-size"]),r["font-weight"]&&(s.fontWeight=r["font-weight"]),r["font-style"]&&(s.fontStyle=r["font-style"]),null!=r.opacity||null!=r["stroke-width"]||null!=r.fill||null!=r.stroke||null!=r["stroke-width"]||null!=r["stroke-opacity"]||null!=r["fill-opacity"]||null!=r["stroke-dasharray"]||null!=r["stroke-miterlimit"]||null!=r["stroke-linejoin"]||null!=r["stroke-linecap"]){a=e.shape||a;var m=a.getElementsByTagName(I)&&a.getElementsByTagName(I)[0],x=!1;if(!m&&(x=m=ae(I)),"fill-opacity"in r||"opacity"in r){var k=((+o["fill-opacity"]+1||2)-1)*((+o.opacity+1||2)-1)*((+t.getRGB(r.fill).o+1||2)-1);k=O(_(k,0),1),m.opacity=k}if(r.fill&&(m.on=!0),null!=m.on&&"none"!=r.fill||(m.on=!1),m.on&&r.fill){var B=r.fill.match(G);B?(m.src=B[1],m.type="tile"):(m.color=t.getRGB(r.fill).hex,m.src=w,m.type="solid",t.getRGB(r.fill).error&&(h.type in{circle:1,ellipse:1}||"r"!=E(r.fill).charAt())&&Lt(h,r.fill)&&(o.fill="none",o.gradient=r.fill))}x&&a[g](m);var C=a.getElementsByTagName("stroke")&&a.getElementsByTagName("stroke")[0],M=!1;!C&&(M=C=ae("stroke")),(r.stroke&&"none"!=r.stroke||r["stroke-width"]||null!=r["stroke-opacity"]||r["stroke-dasharray"]||r["stroke-miterlimit"]||r["stroke-linejoin"]||r["stroke-linecap"])&&(C.on=!0),("none"==r.stroke||null==C.on||0==r.stroke||0==r["stroke-width"])&&(C.on=!1);var A=t.getRGB(r.stroke);C.on&&r.stroke&&(C.color=A.hex),k=((+o["stroke-opacity"]+1||2)-1)*((+o.opacity+1||2)-1)*((+A.o+1||2)-1);var $=.75*(X(r["stroke-width"])||1);if(k=O(_(k,0),1),null==r["stroke-width"]&&($=o["stroke-width"]),r["stroke-width"]&&(C.weight=$),$&&$<1&&(k*=$)&&(C.weight=1),C.opacity=k,r["stroke-linejoin"]&&(C.joinstyle=r["stroke-linejoin"]||"miter"),C.miterlimit=r["stroke-miterlimit"]||8,r["stroke-linecap"]&&(C.endcap="butt"==r["stroke-linecap"]?"flat":"square"==r["stroke-linecap"]?"square":"round"),r["stroke-dasharray"]){var P={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};C.dashstyle=P[f](r["stroke-dasharray"])?P[r["stroke-dasharray"]]:w}M&&a[g](C)}if("text"==h.type)switch(s=h.paper.span.style,o.font&&(s.font=o.font),o["font-family"]&&(s.fontFamily=o["font-family"]),o["font-size"]&&(s.fontSize=o["font-size"]),o["font-weight"]&&(s.fontWeight=o["font-weight"]),o["font-style"]&&(s.fontStyle=o["font-style"]),h.node.string&&(h.paper.span.innerHTML=E(h.node.string)[et](/</g,"&#60;")[et](/&/g,"&#38;")[et](/\n/g,"<br>")),h.W=o.w=h.paper.span.offsetWidth,h.H=o.h=h.paper.span.offsetHeight,h.X=o.x,h.Y=o.y+V(h.H/2),o["text-anchor"]){case"start":h.node.style["v-text-align"]="left",h.bbx=V(h.W/2);break;case"end":h.node.style["v-text-align"]="right",h.bbx=-V(h.W/2);break;default:h.node.style["v-text-align"]="center"}},Lt=function(t,e){t.attrs=t.attrs||{};var r,i=(t.attrs,"linear"),n=".5 .5";if(t.attrs.gradient=e,e=E(e)[et](lt,function(t,e,r){return i="radial",e&&r&&(e=X(e),r=X(r),S(e-.5,2)+S(r-.5,2)>.25&&(r=$.sqrt(.25-S(e-.5,2))*(2*(r>.5)-1)+.5),n=e+k+r),w}),e=e[T](/\s*\-\s*/),"linear"==i){var a=e.shift();if(a=-X(a),isNaN(a))return null}var o=Ct(e);if(!o)return null;if(t=t.shape||t.node,r=t.getElementsByTagName(I)[0]||ae(I),!r.parentNode&&t.appendChild(r),o[N]){r.on=!0,r.method="none",r.color=o[0].color,r.color2=o[o[N]-1].color;for(var s=[],l=0,c=o[N];l<c;l++)o[l].offset&&s[z](o[l].offset+k+o[l].color);r.colors&&(r.colors.value=s[N]?s[M]():"0% "+r.color),"radial"==i?(r.type="gradientradial",r.focus="100%",r.focussize=n,r.focusposition=n):(r.type="gradient",r.angle=(270-a)%360)}return 1},zt=function(e,r,i){this[0]=e,this.id=t._oid++,this.node=e,e.raphael=this,this.X=0,this.Y=0,this.attrs={},this.Group=r,this.paper=i,this._={tx:0,ty:0,rt:{deg:0},sx:1,sy:1},!i.bottom&&(i.bottom=this),this.prev=i.top,i.top&&(i.top.next=this),i.top=this,this.next=null},Gt=zt[u],Gt.rotate=function(t,e,r){return this.removed?this:null==t?this._.rt.cx?[this._.rt.deg,this._.rt.cx,this._.rt.cy][M](k):this._.rt.deg:(t=E(t)[T](l),t[N]-1&&(e=X(t[1]),r=X(t[2])),t=X(t[0]),null!=e?this._.rt.deg=t:this._.rt.deg+=t,null==r&&(e=null),this._.rt.cx=e,this._.rt.cy=r,this.setBox(this.attrs,e,r),this.Group.style.rotation=this._.rt.deg,this)},Gt.setBox=function(t,e,r){if(this.removed)return this;var i=this.Group.style,n=this.shape&&this.shape.style||this.node.style;t=t||{};for(var a in t)t[f](a)&&(this.attrs[a]=t[a]);e=e||this._.rt.cx,r=r||this._.rt.cy;var o,s,l,c,h=this.attrs;switch(this.type){case"circle":o=h.cx-h.r,s=h.cy-h.r,l=c=2*h.r;break;case"ellipse":o=h.cx-h.rx,s=h.cy-h.ry,l=2*h.rx,c=2*h.ry;break;case"image":o=+h.x,s=+h.y,l=h.width||0,c=h.height||0;break;case"text":this.textpath.v=["m",V(h.x),", ",V(h.y-2),"l",V(h.x)+1,", ",V(h.y-2)][M](w),o=h.x-V(this.W/2),s=h.y-this.H/2,l=this.W,c=this.H;break;case"rect":case"path":if(this.attrs.path){var u=vt(this.attrs.path);o=u.x,s=u.y,l=u.width,c=u.height}else o=0,s=0,l=this.paper.width,c=this.paper.height;break;default:o=0,s=0,l=this.paper.width,c=this.paper.height}e=null==e?o+l/2:e,r=null==r?s+c/2:r;var d,p=e-this.paper.width/2,b=r-this.paper.height/2;i.left!=(d=p+"px")&&(i.left=d),i.top!=(d=b+"px")&&(i.top=d),this.X=ie[f](this.type)?-p:o,this.Y=ie[f](this.type)?-b:s,this.W=l,this.H=c,ie[f](this.type)?(n.left!=(d=-p*re+"px")&&(n.left=d),n.top!=(d=-b*re+"px")&&(n.top=d)):"text"==this.type?(n.left!=(d=-p+"px")&&(n.left=d),n.top!=(d=-b+"px")&&(n.top=d)):(i.width!=(d=this.paper.width+"px")&&(i.width=d),i.height!=(d=this.paper.height+"px")&&(i.height=d),n.left!=(d=o-p+"px")&&(n.left=d),n.top!=(d=s-b+"px")&&(n.top=d),n.width!=(d=l+"px")&&(n.width=d),n.height!=(d=c+"px")&&(n.height=d))},Gt.hide=function(){return!this.removed&&(this.Group.style.display="none"),this},Gt.show=function(){return!this.removed&&(this.Group.style.display="block"),this},Gt.getBBox=function(){return this.removed?this:ie[f](this.type)?vt(this.attrs.path):{x:this.X+(this.bbx||0),y:this.Y,width:this.W,height:this.H}},Gt.remove=function(){if(!this.removed){At(this,this.paper),this.node.parentNode.removeChild(this.node),this.Group.parentNode.removeChild(this.Group),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var t in this)delete this[t];this.removed=!0}},Gt.attr=function(e,r){if(this.removed)return this;if(null==e){var i={};for(var n in this.attrs)this.attrs[f](n)&&(i[n]=this.attrs[n]);return this._.rt.deg&&(i.rotation=this.rotate()),(1!=this._.sx||1!=this._.sy)&&(i.scale=this.scale()),i.gradient&&"none"==i.fill&&(i.fill=i.gradient)&&delete i.gradient,i}if(null==r&&t.is(e,"string"))return"translation"==e?Ce.call(this):"rotation"==e?this.rotate():"scale"==e?this.scale():e==I&&"none"==this.attrs.fill&&this.attrs.gradient?this.attrs.gradient:this.attrs[e];if(this.attrs&&null==r&&t.is(e,W)){var a,o={};for(n=0,a=e[N];n<a;n++)o[e[n]]=this.attr(e[n]);return o}var s;if(null!=r&&(s={},s[e]=r),null==r&&t.is(e,"object")&&(s=e),s){for(var l in this.paper.customAttributes)if(this.paper.customAttributes[f](l)&&s[f](l)&&t.is(this.paper.customAttributes[l],"function")){var c=this.paper.customAttributes[l].apply(this,[][m](s[l]));this.attrs[l]=s[l];for(var h in c)c[f](h)&&(s[h]=c[h])}s.text&&"text"==this.type&&(this.node.string=s.text),Dt(this,s),s.gradient&&({circle:1,ellipse:1}[f](this.type)||"r"!=E(s.gradient).charAt())&&Lt(this,s.gradient),(!ie[f](this.type)||this._.rt.deg)&&this.setBox(this.attrs)}return this},Gt.toFront=function(){return!this.removed&&this.Group.parentNode[g](this.Group),this.paper.top!=this&&$t(this,this.paper),this},Gt.toBack=function(){return this.removed?this:(this.Group.parentNode.firstChild!=this.Group&&(this.Group.parentNode.insertBefore(this.Group,this.Group.parentNode.firstChild),_t(this,this.paper)),this)},Gt.insertAfter=function(t){return this.removed?this:(t.constructor==Me&&(t=t[t.length-1]),t.Group.nextSibling?t.Group.parentNode.insertBefore(this.Group,t.Group.nextSibling):t.Group.parentNode[g](this.Group),Ot(this,t,this.paper),this)},Gt.insertBefore=function(t){return this.removed?this:(t.constructor==Me&&(t=t[0]),t.Group.parentNode.insertBefore(this.Group,t.Group),Pt(this,t,this.paper),this)},Gt.blur=function(e){var r=this.node.runtimeStyle,i=r.filter;i=i.replace(Kt,w),0!==+e?(this.attrs.blur=e,r.filter=i+k+Z+".Blur(pixelradius="+(+e||1.5)+")",r.margin=t.format("-{0}px 0 0 -{0}px",V(+e||1.5))):(r.filter=i,r.margin=0,delete this.attrs.blur)},Ht=function(t,e,r,i){var n=ae("group"),a=ae("oval");a.style;n.style.cssText="position:absolute;left:0;top:0;width:"+t.width+"px;height:"+t.height+"px",n.coordsize=ee,n.coordorigin=t.coordorigin,n[g](a);var o=new zt(a,n,t);return o.type="circle",Dt(o,{stroke:"#000",fill:"none"}),o.attrs.cx=e,o.attrs.cy=r,o.attrs.r=i,o.setBox({x:e-i,y:r-i,width:2*i,height:2*i}),t.canvas[g](n),o},Ut=function(t,e,r,n,a,o){var s=i(e,r,n,a,o),l=t.path(s),c=l.attrs;return l.X=c.x=e,l.Y=c.y=r,l.W=c.width=n,l.H=c.height=a,c.r=o,c.path=s,l.type="rect",l},qt=function(t,e,r,i,n){var a=ae("group"),o=ae("oval");o.style;a.style.cssText="position:absolute;left:0;top:0;width:"+t.width+"px;height:"+t.height+"px",a.coordsize=ee,a.coordorigin=t.coordorigin,a[g](o);var s=new zt(o,a,t);return s.type="ellipse",Dt(s,{stroke:"#000"}),s.attrs.cx=e,s.attrs.cy=r,s.attrs.rx=i,s.attrs.ry=n,s.setBox({x:e-i,y:r-n,width:2*i,height:2*n}),t.canvas[g](a),s},Vt=function(t,e,r,i,n,a){var o=ae("group"),s=ae("image");o.style.cssText="position:absolute;left:0;top:0;width:"+t.width+"px;height:"+t.height+"px",o.coordsize=ee,o.coordorigin=t.coordorigin,s.src=e,o[g](s);var l=new zt(s,o,t);return l.type="image",l.attrs.src=e,l.attrs.x=r,l.attrs.y=i,l.attrs.w=n,l.attrs.h=a,l.setBox({x:r,y:i,width:n,height:a}),t.canvas[g](o),l},Yt=function(e,r,i,n){var a=ae("group"),o=ae("shape"),s=o.style,l=ae("path"),c=(l.style,ae("textpath"));a.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px",a.coordsize=ee,a.coordorigin=e.coordorigin,l.v=t.format("m{0},{1}l{2},{1}",V(10*r),V(10*i),V(10*r)+1),l.textpathok=!0,s.width=e.width,s.height=e.height,c.string=E(n),c.on=!0,o[g](c),o[g](l),a[g](o);var h=new zt(c,a,e);return h.shape=o,h.textpath=l,h.type="text",h.attrs.text=n,h.attrs.x=r,h.attrs.y=i,h.attrs.w=1,h.attrs.h=1,Dt(h,{font:K.font,stroke:"none",fill:"#000"}),h.setBox(),e.canvas[g](a),h},Xt=function(t,e){var r=this.canvas.style;return t==+t&&(t+="px"),e==+e&&(e+="px"),r.width=t,r.height=e,r.clip="rect(0 "+t+" "+e+" 0)",this};var ae;d.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!d.namespaces.rvml&&d.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),ae=function(t){return d.createElement("<rvml:"+t+' class="rvml">')}}catch(t){ae=function(t){return d.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}Qt=function(){var e=Mt[y](0,arguments),r=e.container,i=e.height,n=e.width,a=e.x,o=e.y;if(!r)throw new Error("VML container not found.");var s=new v,l=s.canvas=d.createElement("div"),c=l.style;return a=a||0,o=o||0,n=n||512,i=i||342,n==+n&&(n+="px"),i==+i&&(i+="px"),s.width=1e3,s.height=1e3,s.coordsize=1e3*re+k+1e3*re,s.coordorigin="0 0",s.span=d.createElement("span"),s.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",l[g](s.span),c.cssText=t.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",n,i),1==r?(d.body[g](l),c.left=a+"px",c.top=o+"px",c.position="absolute"):r.firstChild?r.insertBefore(l,r.firstChild):r[g](l),Nt.call(s,s,t.fn),s},s.clear=function(){this.canvas.innerHTML=w,this.span=d.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas[g](this.span),this.bottom=this.top=null},s.remove=function(){this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]=St(t);return!0}}var oe=navigator.userAgent.match(/Version\\x2f(.*?)\s/);"Apple Computer, Inc."==navigator.vendor&&(oe&&oe[1]<4||"iP"==navigator.platform.slice(0,2))?s.safari=function(){var t=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});p.setTimeout(function(){t.remove()})}:s.safari=function(){};for(var se=function(){this.returnValue=!1},le=function(){return this.originalEvent.preventDefault()},ce=function(){this.cancelBubble=!0},he=function(){return this.originalEvent.stopPropagation()},ue=function(){return d.addEventListener?function(t,e,r,i){var n=x&&C[e]?C[e]:e,a=function(n){if(x&&C[f](e))for(var a=0,o=n.targetTouches&&n.targetTouches.length;a<o;a++)if(n.targetTouches[a].target==t){var s=n;n=n.targetTouches[a],n.originalEvent=s,n.preventDefault=le,n.stopPropagation=he;break}return r.call(i,n)};return t.addEventListener(n,a,!1),function(){return t.removeEventListener(n,a,!1),!0}}:d.attachEvent?function(t,e,r,i){var n=function(t){return t=t||p.event,t.preventDefault=t.preventDefault||se,t.stopPropagation=t.stopPropagation||ce,r.call(i,t)};t.attachEvent("on"+e,n);var a=function(){return t.detachEvent("on"+e,n),!0};return a}:void 0}(),fe=[],de=function(t){for(var e,r=t.clientX,i=t.clientY,n=d.documentElement.scrollTop||d.body.scrollTop,a=d.documentElement.scrollLeft||d.body.scrollLeft,o=fe.length;o--;){if(e=fe[o],x){for(var s,l=t.touches.length;l--;)if(s=t.touches[l],s.identifier==e.el._drag.id){r=s.clientX,i=s.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();r+=a,i+=n,e.move&&e.move.call(e.move_scope||e.el,r-e.el._drag.x,i-e.el._drag.y,r,i,t)}},pe=function(e){t.unmousemove(de).unmouseup(pe);for(var r,i=fe.length;i--;)r=fe[i],r.el._drag={},r.end&&r.end.call(r.end_scope||r.start_scope||r.move_scope||r.el,e);fe=[]},be=B[N];be--;)(function(e){t[e]=zt[u][e]=function(r,i){return t.is(r,"function")&&(this.events=this.events||[],this.events.push({name:e,f:r,unbind:ue(this.shape||this.node||d,e,r,i||this)})),this},t["un"+e]=zt[u]["un"+e]=function(t){for(var r=this.events,i=r[N];i--;)if(r[i].name==e&&r[i].f==t)return r[i].unbind(),r.splice(i,1),!r.length&&delete this.events,this;return this}})(B[be]);Gt.hover=function(t,e,r,i){return this.mouseover(t,r).mouseout(e,i||r)},Gt.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)},Gt.drag=function(e,r,i,n,a,o){return this._drag={},this.mousedown(function(s){(s.originalEvent||s).preventDefault();var l=d.documentElement.scrollTop||d.body.scrollTop,c=d.documentElement.scrollLeft||d.body.scrollLeft;this._drag.x=s.clientX+c,this._drag.y=s.clientY+l,this._drag.id=s.identifier,r&&r.call(a||n||this,s.clientX+c,s.clientY+l,s),!fe.length&&t.mousemove(de).mouseup(pe),fe.push({el:this,move:e,end:i,move_scope:n,start_scope:a,end_scope:o})}),this},Gt.undrag=function(e,r,i){for(var n=fe.length;n--;)fe[n].el==this&&fe[n].move==e&&fe[n].end==i&&fe.splice(n++,1);!fe.length&&t.unmousemove(de).unmouseup(pe)},s.circle=function(t,e,r){return Ht(this,t||0,e||0,r||0)},s.rect=function(t,e,r,i,n){return Ut(this,t||0,e||0,r||0,i||0,n||0)},s.ellipse=function(t,e,r,i){return qt(this,t||0,e||0,r||0,i||0)},s.path=function(e){return e&&!t.is(e,L)&&!t.is(e[0],W)&&(e+=w),jt(t.format[y](t,arguments),this)},s.image=function(t,e,r,i,n){return Vt(this,t||"about:blank",e||0,r||0,i||0,n||0)},s.text=function(t,e,r){return Yt(this,t||0,e||0,E(r))},s.set=function(t){return arguments[N]>1&&(t=Array[u].splice.call(arguments,0,arguments[N])),new Me(t)},s.setSize=Xt,s.top=s.bottom=null,s.raphael=t,Gt.resetScale=function(){return this.removed?this:(this._.sx=1,this._.sy=1,void(this.attrs.scale="1 1"))},Gt.scale=function(t,e,r,i){if(this.removed)return this;if(null==t&&null==e)return{x:this._.sx,y:this._.sy,toString:n};e=e||t,!+e&&(e=t);var a,o,s=this.attrs;if(0!=t){var l=this.getBBox(),c=l.x+l.width/2,h=l.y+l.height/2,u=P(t/this._.sx),f=P(e/this._.sy);r=+r||0==r?r:c,i=+i||0==i?i:h;var d=this._.sx>0,p=this._.sy>0,b=~~(t/P(t)),v=~~(e/P(e)),g=u*b,y=f*v,x=this.node.style,E=r+P(c-r)*g*(c>r==d?1:-1),T=i+P(h-i)*y*(h>i==p?1:-1),B=t*b>e*v?f:u;switch(this.type){case"rect":case"image":var C=s.width*u,A=s.height*f;this.attr({height:A,r:s.r*B,width:C,x:E-C/2,y:T-A/2});break;case"circle":case"ellipse":this.attr({rx:s.rx*u,ry:s.ry*f,r:s.r*B,cx:E,cy:T});break;case"text":this.attr({x:E,y:T});break;case"path":for(var $=yt(s.path),_=!0,O=d?g:u,S=p?y:f,R=0,j=$[N];R<j;R++){var L=$[R],W=J.call(L[0]);if("M"!=W||!_)if(_=!1,"A"==W)L[$[R][N]-2]*=O,L[$[R][N]-1]*=S,L[1]*=u,L[2]*=f,L[5]=+(b+v?!!+L[5]:!+L[5]);else if("H"==W)for(var D=1,I=L[N];D<I;D++)L[D]*=O;else if("V"==W)for(D=1,I=L[N];D<I;D++)L[D]*=S;else for(D=1,I=L[N];D<I;D++)L[D]*=D%2?O:S}var F=vt($);a=E-F.x-F.width/2,o=T-F.y-F.height/2,$[0][1]+=a,$[0][2]+=o,this.attr({path:$})}this.type in{text:1,image:1}&&(1!=b||1!=v)?this.transformations?(this.transformations[2]="scale("[m](b,",",v,")"),this.node[Y]("transform",this.transformations[M](k)),a=b==-1?-s.x-(C||0):s.x,o=v==-1?-s.y-(A||0):s.y,this.attr({x:a,y:o}),s.fx=b-1,s.fy=v-1):(this.node.filterMatrix=Z+".Matrix(M11="[m](b,", M12=0, M21=0, M22=",v,", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')"),x.filter=(this.node.filterMatrix||w)+(this.node.filterOpacity||w)):this.transformations?(this.transformations[2]=w,this.node[Y]("transform",this.transformations[M](k)),s.fx=0,s.fy=0):(this.node.filterMatrix=w,x.filter=(this.node.filterMatrix||w)+(this.node.filterOpacity||w)),s.scale=[t,e,r,i][M](k),this._.sx=t,this._.sy=e}return this},Gt.clone=function(){if(this.removed)return null;var t=this.attr();return delete t.scale,delete t.translation,this.paper[this.type]().attr(t)};var ve={},ge=function(e,r,i,n,a,o,s,l,c){var h,u,f=0,d=100,p=[e,r,i,n,a,o,s,l].join(),b=ve[p];if(!b&&(ve[p]=b={data:[]}),b.timer&&clearTimeout(b.timer),b.timer=setTimeout(function(){delete ve[p]},2e3),null!=c){var v=ge(e,r,i,n,a,o,s,l);d=10*~~v}for(var g=0;g<d+1;g++){if(b.data[c]>g?u=b.data[g*d]:(u=t.findDotsAtSegment(e,r,i,n,a,o,s,l,g/d),b.data[g]=u),g&&(f+=S(S(h.x-u.x,2)+S(h.y-u.y,2),.5)),null!=c&&f>=c)return u;h=u}if(null==c)return f},ye=function(e,r){return function(i,n,a){i=Bt(i);for(var o,s,l,c,h,u="",f={},d=0,p=0,b=i.length;p<b;p++){if(l=i[p],"M"==l[0])o=+l[1],s=+l[2];else{if(c=ge(o,s,l[1],l[2],l[3],l[4],l[5],l[6]),d+c>n){if(r&&!f.start){if(h=ge(o,s,l[1],l[2],l[3],l[4],l[5],l[6],n-d),u+=["C",h.start.x,h.start.y,h.m.x,h.m.y,h.x,h.y],a)return u;f.start=u,u=["M",h.x,h.y+"C",h.n.x,h.n.y,h.end.x,h.end.y,l[5],l[6]][M](),d+=c,o=+l[5],s=+l[6];continue}if(!e&&!r)return h=ge(o,s,l[1],l[2],l[3],l[4],l[5],l[6],n-d),{x:h.x,y:h.y,alpha:h.alpha}}d+=c,o=+l[5],s=+l[6]}u+=l}return f.end=u,h=e?d:r?f:t.findDotsAtSegment(o,s,l[1],l[2],l[3],l[4],l[5],l[6],1),h.alpha&&(h={x:h.x,y:h.y,alpha:h.alpha}),h}},me=ye(1),xe=ye(),we=ye(0,1);Gt.getTotalLength=function(){if("path"==this.type)return this.node.getTotalLength?this.node.getTotalLength():me(this.attrs.path)},Gt.getPointAtLength=function(t){if("path"==this.type)return xe(this.attrs.path,t)},Gt.getSubpath=function(t,e){if("path"==this.type){if(P(this.getTotalLength()-e)<"1e-6")return we(this.attrs.path,t).end;var r=we(this.attrs.path,e,1);return t?we(r,t).end:r}},t.easing_formulas={linear:function(t){return t},"<":function(t){return S(t,3)},">":function(t){return S(t-1,3)+1},"<>":function(t){return t=2*t,t<1?S(t,3)/2:(t-=2,(S(t,3)+2)/2)},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){t-=1;var e=1.70158;return t*t*((e+1)*t+e)+1},elastic:function(t){if(0==t||1==t)return t;var e=.3,r=e/4;return S(2,-10*t)*$.sin((t-r)*(2*R)/e)+1},bounce:function(t){var e,r=7.5625,i=2.75;return t<1/i?e=r*t*t:t<2/i?(t-=1.5/i,e=r*t*t+.75):t<2.5/i?(t-=2.25/i,e=r*t*t+.9375):(t-=2.625/i,e=r*t*t+.984375),e}};var ke=[],Ee=function(){for(var e=+new Date,r=0;r<ke[N];r++){var i=ke[r];if(!i.stop&&!i.el.removed){var n,a=e-i.start,o=i.ms,s=i.easing,l=i.from,c=i.diff,h=i.to,u=i.t,d=i.el,p={};if(a<o){var b=s(a/o);for(var v in l)if(l[f](v)){switch(tt[v]){case"along":n=b*o*c[v],h.back&&(n=h.len-n);var g=xe(h[v],n);d.translate(c.sx-c.x||0,c.sy-c.y||0),c.x=g.x,c.y=g.y,d.translate(g.x-c.sx,g.y-c.sy),h.rot&&d.rotate(c.r+g.alpha,g.x,g.y);break;case j:n=+l[v]+b*o*c[v];break;case"colour":n="rgb("+[Be(V(l[v].r+b*o*c[v].r)),Be(V(l[v].g+b*o*c[v].g)),Be(V(l[v].b+b*o*c[v].b))][M](",")+")";break;case"path":n=[];for(var y=0,m=l[v][N];y<m;y++){n[y]=[l[v][y][0]];for(var x=1,E=l[v][y][N];x<E;x++)n[y][x]=+l[v][y][x]+b*o*c[v][y][x];n[y]=n[y][M](k)}n=n[M](k);break;case"csv":switch(v){case"translation":var T=b*o*c[v][0]-u.x,B=b*o*c[v][1]-u.y;u.x+=T,u.y+=B,n=T+k+B;break;case"rotation":n=+l[v][0]+b*o*c[v][0],l[v][1]&&(n+=","+l[v][1]+","+l[v][2]);break;case"scale":n=[+l[v][0]+b*o*c[v][0],+l[v][1]+b*o*c[v][1],2 in h[v]?h[v][2]:w,3 in h[v]?h[v][3]:w][M](k);break;case"clip-rect":for(n=[],y=4;y--;)n[y]=+l[v][y]+b*o*c[v][y]}break;default:var C=[].concat(l[v]);for(n=[],y=d.paper.customAttributes[v].length;y--;)n[y]=+C[y]+b*o*c[v][y]}p[v]=n}d.attr(p),d._run&&d._run.call(d)}else h.along&&(g=xe(h.along,h.len*!h.back),d.translate(c.sx-(c.x||0)+g.x-c.sx,c.sy-(c.y||0)+g.y-c.sy),h.rot&&d.rotate(c.r+g.alpha,g.x,g.y)),(u.x||u.y)&&d.translate(-u.x,-u.y),h.scale&&(h.scale+=w),d.attr(h),ke.splice(r--,1)}}t.svg&&d&&d.paper&&d.paper.safari(),ke[N]&&setTimeout(Ee)},Te=function(e,r,i,n,a){var o=i-n;r.timeouts.push(setTimeout(function(){t.is(a,"function")&&a.call(r),r.animate(e,o,e.easing)},n))},Be=function(t){return _(O(t,255),0)},Ce=function(t,e){if(null==t)return{x:this._.tx,y:this._.ty,toString:n};switch(this._.tx+=+t,this._.ty+=+e,this.type){case"circle":case"ellipse":this.attr({cx:+t+this.attrs.cx,cy:+e+this.attrs.cy});break;case"rect":case"image":case"text":this.attr({x:+t+this.attrs.x,y:+e+this.attrs.y});break;case"path":var r=yt(this.attrs.path);r[0][1]+=+t,r[0][2]+=+e,this.attr({path:r})}return this};Gt.animateWith=function(t,e,r,i,n){for(var a=0,o=ke.length;a<o;a++)ke[a].el.id==t.id&&(e.start=ke[a].start);return this.animate(e,r,i,n)},Gt.animateAlong=a(),Gt.animateAlongBack=a(1),Gt.onAnimation=function(t){return this._run=t||0,this},Gt.animate=function(e,r,i,n){var a=this;if(a.timeouts=a.timeouts||[],!t.is(i,"function")&&i||(n=i||null),a.removed)return n&&n.call(a),a;var s={},c={},h=!1,u={};for(var d in e)if(e[f](d)&&(tt[f](d)||a.paper.customAttributes[f](d)))switch(h=!0,s[d]=a.attr(d),null==s[d]&&(s[d]=K[d]),c[d]=e[d],tt[d]){case"along":var p=me(e[d]),b=xe(e[d],p*!!e.back),v=a.getBBox();u[d]=p/r,u.tx=v.x,u.ty=v.y,u.sx=b.x,u.sy=b.y,c.rot=e.rot,c.back=e.back,c.len=p,e.rot&&(u.r=X(a.rotate())||0);break;case j:u[d]=(c[d]-s[d])/r;break;case"colour":s[d]=t.getRGB(s[d]);var g=t.getRGB(c[d]);u[d]={r:(g.r-s[d].r)/r,g:(g.g-s[d].g)/r,b:(g.b-s[d].b)/r};break;case"path":var y=Bt(s[d],c[d]);s[d]=y[0];var m=y[1];u[d]=[];for(var x=0,w=s[d][N];x<w;x++){u[d][x]=[0];for(var k=1,B=s[d][x][N];k<B;k++)u[d][x][k]=(m[x][k]-s[d][x][k])/r}break;case"csv":var C=E(e[d])[T](l),M=E(s[d])[T](l);switch(d){case"translation":s[d]=[0,0],u[d]=[C[0]/r,C[1]/r];break;case"rotation":s[d]=M[1]==C[1]&&M[2]==C[2]?M:[0,C[1],C[2]],u[d]=[(C[0]-s[d][0])/r,0,0];break;case"scale":e[d]=C,s[d]=E(s[d])[T](l),u[d]=[(C[0]-s[d][0])/r,(C[1]-s[d][1])/r,0,0];break;case"clip-rect":for(s[d]=E(s[d])[T](l),u[d]=[],x=4;x--;)u[d][x]=(C[x]-s[d][x])/r}c[d]=C;break;default:for(C=[].concat(e[d]),M=[].concat(s[d]),u[d]=[],x=a.paper.customAttributes[d][N];x--;)u[d][x]=((C[x]||0)-(M[x]||0))/r}if(h){var A=t.easing_formulas[i];if(!A)if(A=E(i).match(q),A&&5==A[N]){var $=A;A=function(t){return o(t,+$[1],+$[2],+$[3],+$[4],r)}}else A=function(t){return t};ke.push({start:e.start||+new Date,ms:r,easing:A,from:s,diff:u,to:c,el:a,t:{x:0,y:0}}),t.is(n,"function")&&(a._ac=setTimeout(function(){n.call(a)},r)),1==ke[N]&&setTimeout(Ee)}else{var _,O=[];for(var P in e)e[f](P)&&rt.test(P)&&(d={value:e[P]},"from"==P&&(P=0),"to"==P&&(P=100),d.key=Q(P,10),O.push(d));for(O.sort(ct),O[0].key&&O.unshift({key:0,value:a.attrs}),x=0,w=O[N];x<w;x++)Te(O[x].value,a,r/100*O[x].key,r/100*(O[x-1]&&O[x-1].key||0),O[x-1]&&O[x-1].value.callback);_=O[O[N]-1].value.callback,_&&a.timeouts.push(setTimeout(function(){_.call(a)},r))}return this},Gt.stop=function(){for(var t=0;t<ke.length;t++)ke[t].el.id==this.id&&ke.splice(t--,1);for(t=0,ii=this.timeouts&&this.timeouts.length;t<ii;t++)clearTimeout(this.timeouts[t]);return this.timeouts=[],clearTimeout(this._ac),delete this._ac,this},Gt.translate=function(t,e){return this.attr({translation:t+" "+e})},Gt[D]=function(){return"Raphaël’s object"},t.ae=ke;var Me=function(t){if(this.items=[],this[N]=0,this.type="set",t)for(var e=0,r=t[N];e<r;e++)!t[e]||t[e].constructor!=zt&&t[e].constructor!=Me||(this[this.items[N]]=this.items[this.items[N]]=t[e],this[N]++)};Me[u][z]=function(){for(var t,e,r=0,i=arguments[N];r<i;r++)t=arguments[r],!t||t.constructor!=zt&&t.constructor!=Me||(e=this.items[N],this[e]=this.items[e]=t,this[N]++);return this},Me[u].pop=function(){return delete this[this[N]--],this.items.pop()};for(var Ne in Gt)Gt[f](Ne)&&(Me[u][Ne]=function(t){return function(){for(var e=0,r=this.items[N];e<r;e++)this.items[e][t][y](this.items[e],arguments);return this}}(Ne));Me[u].attr=function(e,r){if(e&&t.is(e,W)&&t.is(e[0],"object"))for(var i=0,n=e[N];i<n;i++)this.items[i].attr(e[i]);else for(var a=0,o=this.items[N];a<o;a++)this.items[a].attr(e,r);return this},Me[u].animate=function(e,r,i,n){(t.is(i,"function")||!i)&&(n=i||null);var a,o,s=this.items[N],l=s,c=this;for(n&&(o=function(){!--s&&n.call(c)}),i=t.is(i,L)?i:o,a=this.items[--l].animate(e,r,i,o);l--;)this.items[l]&&!this.items[l].removed&&this.items[l].animateWith(a,e,r,i,o);return this},Me[u].insertAfter=function(t){for(var e=this.items[N];e--;)this.items[e].insertAfter(t);return this},Me[u].getBBox=function(){for(var t=[],e=[],r=[],i=[],n=this.items[N];n--;){var a=this.items[n].getBBox();t[z](a.x),e[z](a.y),r[z](a.x+a.width),i[z](a.y+a.height)}return t=O[y](0,t),e=O[y](0,e),{x:t,y:e,width:_[y](0,r)-t,height:_[y](0,i)-e}},Me[u].clone=function(t){t=new Me;for(var e=0,r=this.items[N];e<r;e++)t[z](this.items[e].clone());return t},t.registerFont=function(t){if(!t.face)return t;this.fonts=this.fonts||{};var e={w:t.w,face:{},glyphs:{}},r=t.face["font-family"];for(var i in t.face)t.face[f](i)&&(e.face[i]=t.face[i]);if(this.fonts[r]?this.fonts[r][z](e):this.fonts[r]=[e],!t.svg){e.face["units-per-em"]=Q(t.face["units-per-em"],10);for(var n in t.glyphs)if(t.glyphs[f](n)){var a=t.glyphs[n];if(e.glyphs[n]={w:a.w,k:{},d:a.d&&"M"+a.d[et](/[mlcxtrv]/g,function(t){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[t]||"M"})+"z"},a.k)for(var o in a.k)a[f](o)&&(e.glyphs[n].k[o]=a.k[o])}}return t},s.getFont=function(e,r,i,n){if(n=n||"normal",i=i||"normal",r=+r||{normal:400,bold:700,lighter:300,bolder:800}[r]||400,t.fonts){var a=t.fonts[e];if(!a){var o=new RegExp("(^|\\s)"+e[et](/[^\w\d\s+!~.:_-]/g,w)+"(\\s|$)","i");for(var s in t.fonts)if(t.fonts[f](s)&&o.test(s)){a=t.fonts[s];break}}var l;if(a)for(var c=0,h=a[N];c<h&&(l=a[c],l.face["font-weight"]!=r||l.face["font-style"]!=i&&l.face["font-style"]||l.face["font-stretch"]!=n);c++);return l}},s.print=function(e,r,i,n,a,o,s){o=o||"middle",s=_(O(s||0,1),-1);var c,h=this.set(),u=E(i)[T](w),f=0;if(t.is(n,i)&&(n=this.getFont(n)),n){c=(a||16)/n.face["units-per-em"];for(var d=n.face.bbox.split(l),p=+d[0],b=+d[1]+("baseline"==o?d[3]-d[1]+ +n.face.descent:(d[3]-d[1])/2),v=0,g=u[N];v<g;v++){var y=v&&n.glyphs[u[v-1]]||{},m=n.glyphs[u[v]];f+=v?(y.w||n.w)+(y.k&&y.k[u[v]]||0)+n.w*s:0,m&&m.d&&h[z](this.path(m.d).attr({fill:"#000",stroke:"none",translation:[f,0]}))}h.scale(c,c,p,b).translate(e-p,r-b)}return h},t.format=function(e,r){var i=t.is(r,W)?[0][m](r):arguments;return e&&t.is(e,L)&&i[N]-1&&(e=e[et](h,function(t,e){return null==i[++e]?w:i[e]})),e||w},t.ninja=function(){return b.was?p.Raphael=b.is:delete Raphael,t},t.el=Gt,t.st=Me[u],b.was?p.Raphael=t:Raphael=t}();var TWEEN=TWEEN||function(){var t,e,r,i,n=[];return{start:function(t){r=setInterval(this.update,1e3/(t||60))},stop:function(){clearInterval(r)},add:function(t){n.push(t)},remove:function(e){t=n.indexOf(e),t!==-1&&n.splice(t,1)},update:function(){for(t=0,e=n.length,i=(new Date).getTime();t<e;)n[t].update(i)?t++:(n.splice(t,1),e--)}}}();TWEEN.Tween=function(t){var e={},r={},i={},n=1e3,a=0,o=null,s=TWEEN.Easing.Linear.EaseNone,l=null,c=null,h=null;this.to=function(e,r){null!==r&&(n=r);for(var a in e)null!==t[a]&&(i[a]=e[a]);return this},this.start=function(){TWEEN.add(this),o=(new Date).getTime()+a;for(var n in i)null!==t[n]&&(e[n]=t[n],r[n]=i[n]-t[n]);return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(t){return a=t,this},this.easing=function(t){return s=t,this},this.chain=function(t){l=t},this.onUpdate=function(t){return c=t,this},this.onComplete=function(t){return h=t,this},this.update=function(i){var a,u;if(i<o)return!0;i=(i-o)/n,i=i>1?1:i,u=s(i);for(a in r)t[a]=e[a]+r[a]*u;return null!==c&&c.call(t,u),1!=i||(null!==h&&h.call(t),null!==l&&l.start(),!1)}},TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},TWEEN.Easing.Linear.EaseNone=function(t){return t},TWEEN.Easing.Quadratic.EaseIn=function(t){return t*t},TWEEN.Easing.Quadratic.EaseOut=function(t){return-t*(t-2)},TWEEN.Easing.Quadratic.EaseInOut=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},TWEEN.Easing.Cubic.EaseIn=function(t){
return t*t*t},TWEEN.Easing.Cubic.EaseOut=function(t){return--t*t*t+1},TWEEN.Easing.Cubic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},TWEEN.Easing.Quartic.EaseIn=function(t){return t*t*t*t},TWEEN.Easing.Quartic.EaseOut=function(t){return-(--t*t*t*t-1)},TWEEN.Easing.Quartic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},TWEEN.Easing.Quintic.EaseIn=function(t){return t*t*t*t*t},TWEEN.Easing.Quintic.EaseOut=function(t){return(t-=1)*t*t*t*t+1},TWEEN.Easing.Quintic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},TWEEN.Easing.Sinusoidal.EaseIn=function(t){return-Math.cos(t*Math.PI/2)+1},TWEEN.Easing.Sinusoidal.EaseOut=function(t){return Math.sin(t*Math.PI/2)},TWEEN.Easing.Sinusoidal.EaseInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},TWEEN.Easing.Exponential.EaseIn=function(t){return 0==t?0:Math.pow(2,10*(t-1))},TWEEN.Easing.Exponential.EaseOut=function(t){return 1==t?1:-Math.pow(2,-10*t)+1},TWEEN.Easing.Exponential.EaseInOut=function(t){return 0==t?0:1==t?1:(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)},TWEEN.Easing.Circular.EaseIn=function(t){return-(Math.sqrt(1-t*t)-1)},TWEEN.Easing.Circular.EaseOut=function(t){return Math.sqrt(1- --t*t)},TWEEN.Easing.Circular.EaseInOut=function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},TWEEN.Easing.Elastic.EaseIn=function(t){var e,r=.1,i=.4;return 0==t?0:1==t?1:(i||(i=.3),!r||r<1?(r=1,e=i/4):e=i/(2*Math.PI)*Math.asin(1/r),-(r*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i)))},TWEEN.Easing.Elastic.EaseOut=function(t){var e,r=.1,i=.4;return 0==t?0:1==t?1:(i||(i=.3),!r||r<1?(r=1,e=i/4):e=i/(2*Math.PI)*Math.asin(1/r),r*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/i)+1)},TWEEN.Easing.Elastic.EaseInOut=function(t){var e,r=.1,i=.4;return 0==t?0:1==t?1:(i||(i=.3),!r||r<1?(r=1,e=i/4):e=i/(2*Math.PI)*Math.asin(1/r),(t*=2)<1?-.5*r*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i):r*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i)*.5+1)},TWEEN.Easing.Back.EaseIn=function(t){return t*t*(2.70158*t-1.70158)},TWEEN.Easing.Back.EaseOut=function(t){return(t-=1)*t*(2.70158*t+1.70158)+1},TWEEN.Easing.Back.EaseInOut=function(t){return(t*=2)<1?.5*t*t*(3.5949095*t-2.5949095):.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)},TWEEN.Easing.Bounce.EaseIn=function(t){return 1-TWEEN.Easing.Bounce.EaseOut(1-t)},TWEEN.Easing.Bounce.EaseOut=function(t){return(t/=1)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},TWEEN.Easing.Bounce.EaseInOut=function(t){return t<.5?.5*TWEEN.Easing.Bounce.EaseIn(2*t):.5*TWEEN.Easing.Bounce.EaseOut(2*t-1)+.5};var BubbleTree=function(t,e,r){var i=this;if(i.version="2.0.2",i.$container=$(t.container),i.config=$.extend({rootPath:"",minRadiusLabels:40,minRadiusAmounts:20,minRadiusHideLabels:0,cutLabelsAt:50},t),i.tooltip=t.tooltipCallback?t.tooltipCallback:function(){},t.tooltip&&(i.tooltip=t.tooltip),i.style=t.bubbleStyles,i.ns=BubbleTree,i.nodesByUrlToken={},i.nodeList=[],i.iconsByUrlToken={},i.globalNodeCounter=0,i.displayObjects=[],i.bubbleScale=1,i.globRotation=0,i.currentYear=t.initYear,i.currentCenter=void 0,i.currentTransition=void 0,i.baseUrl="",i.loadData=function(t){$.ajax({url:t,dataType:"json",success:this.setData.bind(this)})},i.setData=function(t){var e=this;t||(t=e.config.data),e.initData(t),e.initPaper(),e.initBubbles(),e.initTween(),e.initHistory(),e.postProcess(t)},i.postProcess=function(t){if(t){var e=this;angular.forEach(t.children,function(t){e.postProcess(t)})}},i.initData=function(t){var e=this;t.level=0,e.preprocessData(t),e.traverse(t,0),e.treeRoot=t},i.preprocessData=function(t){var e=this,r=e.config.maxNodesPerLevel;if(r&&r<t.children.length){var i=e.sortChildren(t.children);i.reverse();var n,a=[],o=[],s=0;for(var l in t.children)l<r?a.push(t.children[l]):(o.push(t.children[l]),s+=Math.max(0,t.children[l].amount));t.children=a,t.children.push({label:"More",name:"more",amount:s,children:o,breakdown:n})}},i.traverse=function(t,e){var r,i,n=this,a=n.config.bubbleStyles;if(t.children||(t.children=[]),n.nodeList.push(t),t.famount=n.ns.Utils.formatNumber(t.amount),t.parent&&(t.level=t.parent.level+1),n.config.clearColors===!0&&(t.color=!1),a){var o=["color","shortLabel","icon"];$.each(o,function(e,r){a.hasOwnProperty("id")&&a.id.hasOwnProperty(t.id)&&a.id[t.id].hasOwnProperty(r)?t[r]=a.id[t.id][r]:t.hasOwnProperty("name")&&a.hasOwnProperty("name")&&a.name.hasOwnProperty(t.name)&&a.name[t.name].hasOwnProperty(r)?t[r]=a.name[t.name][r]:t.hasOwnProperty("taxonomy")&&a.hasOwnProperty(t.taxonomy)&&a[t.taxonomy].hasOwnProperty(t.name)&&a[t.taxonomy][t.name].hasOwnProperty(r)&&(t[r]=a[t.taxonomy][t.name][r])})}for(t.color||(t.level>0?t.color=t.parent.color:t.color="#999999"),t.children.length<2&&t.color&&(t.color=vis4color.fromHex(t.color).saturation("*.86").x),t.level>0&&(r=t.parent.children,r.length>1&&(t.left=r[(e-1+r.length)%r.length],t.right=r[(Number(e)+1)%r.length],t.right==t.left&&(t.right=void 0))),i=void 0!==t.label&&""!==t.label?t.label:void 0!==t.token&&""!==t.token?t.token:""+n.globalNodeCounter,n.globalNodeCounter++,t.urlToken=i.toLowerCase().replace(/\W/g,"-");n.nodesByUrlToken.hasOwnProperty(t.urlToken);)t.urlToken+="-";n.nodesByUrlToken[t.urlToken]=t,t.maxChildAmount=0,t.children=n.sortChildren(t.children,!0,n.config.sortBy),$.each(t.children,function(e,r){r.parent=t,t.maxChildAmount=Math.max(t.maxChildAmount,r.amount),n.traverse(r,e)}),t.breakdowns&&(t.breakdownsByName={},$.each(t.breakdowns,function(e,r){r.famount=n.ns.Utils.formatNumber(r.amount),r.name&&(t.breakdownsByName[r.name]=r)}))},i.sortChildren=function(t,e,r){var n=[],a=!0;if("label"==r?(r=i.compareLabels,e=!1):r=i.compareAmounts,t.sort(r),e){for(;t.length>0;)n.push(a?t.pop():t.shift()),a=!a;return n}return t},i.compareAmounts=function(t,e){return t.amount>e.amount?1:t.amount==e.amount?0:-1},i.compareLabels=function(t,e){return t.label>e.label?1:t.label==e.label?0:-1},i.initPaper=function(){var t,e=this,r=e.$container,i=e.treeRoot,n=r.width(),a=r.height(),o=Raphael(r[0],n,a),s=.5*Math.min(n,a)-40,l=e.ns.Vector,c=new l(.5*n,.5*a);e.width=n,e.height=a,e.paper=o,t=Math.pow((Math.pow(i.amount,.6)+2*Math.pow(i.maxChildAmount,.6))/s,1.6666666667),e.a2radBase=e.ns.a2radBase=t,e.origin=c,$(window).resize(e.onResize.bind(e))},i.onResize=function(){var t,e=this,r=e.$container,i=r.width(),n=r.height(),a=.5*Math.min(i,n)-40,o=e.treeRoot;e.paper.setSize(i,n),e.origin.x=.5*i,e.origin.y=.5*n,e.width=i,e.height=n,t=Math.pow((Math.pow(o.amount,.6)+2*Math.pow(o.maxChildAmount,.6))/a,1.6666666667),e.a2radBase=e.ns.a2radBase=t,$.each(e.displayObjects,function(t,r){"bubble"==r.className&&(r.bubbleRad=e.ns.Utils.amount2rad(r.node.amount))}),e.currentCenter&&e.changeView(e.currentCenter.urlToken)},i.initTween=function(){this.tweenTimer=setInterval(this.loop,500/120)},i.initBubbles=function(){var t=this,e=t.treeRoot,r=!1;t.ns.Bubbles;t.bubbleClasses=[],t.config.hasOwnProperty("bubbleType")||(t.config.bubbleType=["plain"]),$.isArray(t.config.bubbleType)||(t.config.bubbleType=[t.config.bubbleType]),$.isArray(t.config.bubbleType)&&$.each(t.config.bubbleType,function(e){"icon"==t.config.bubbleType[e]&&(r=!0),t.bubbleClasses.push(t.getBubbleType(t.config.bubbleType[e]))});var i=t.createBubble(e,t.origin,0,0,e.color);t.traverseBubbles(i)},i.getBubbleType=function(t){var e=this,r=e.ns.Bubbles;return r.Donut},i.traverseBubbles=function(t){var e,r,i,n,a,o=this,s=o.ns.Utils.amount2rad,l=0,c=0,h=2*Math.PI;r=t.node.children,$.each(r,function(t,e){l+=s(e.amount)}),r.length>0&&(e=o.createRing(t.node,t.pos,0,{stroke:"#888","stroke-dasharray":"-"})),$.each(r,function(e,r){n=s(r.amount)/l*h,a=c+.5*n,isNaN(a)&&vis4.log(c,n,r.amount,l,h),r.centerAngle=a,i=o.createBubble(r,t.pos,0,a,r.color),c+=n,o.traverseBubbles(i)})},i.createBubble=function(t,e,r,i,n){var a,o=this,s=(o.ns,t.level);return isNaN(s)&&(s=0),s=Math.min(s,o.bubbleClasses.length-1),a=new o.bubbleClasses[s](t,o,e,r,i,n),o.displayObjects.push(a),a},i.createRing=function(t,e,r,i){var n,a=this,o=a.ns;return n=new o.Ring(t,a,e,r,i),a.displayObjects.push(n),n},i.changeView=function(t){var e,r,i,n=this,a=(n.paper,.35*Math.min(n.width,n.height)),o=n.ns,s=o.Utils,l=n.origin,c=s.amount2rad,h=n.treeRoot,u=n.nodesByUrlToken,f=u.hasOwnProperty(t)?u[t]:null,d=new o.Layout,p=2*Math.PI,b=n.getBubble.bind(n),v=n.getRing.bind(n),g=n.unifyAngle;if(null!==f){var y,m,x,w,k,E,T,B,C,M,N,A=!1,_=!1;for(i in n.displayObjects)n.displayObjects[i].hideFlag=!0;if(f==h||f.parent==h&&f.children.length<2){d.$(n).bubbleScale=n.config.scaleFactor?n.config.scaleFactor:1,d.$(l).x=.5*n.width,d.$(l).y=.5*n.height,y=b(h),f!=h&&(y.childRotation=-f.centerAngle),k=c(h.amount)+c(h.maxChildAmount)+40,C=v(h),d.$(C).rad=k;for(i in h.children)w=h.children[i],e=b(w),d.$(e).angle=g(w.centerAngle+y.childRotation),d.$(e).rad=k}else{var O=f;M=f.children.length<2?5:a/(c(f.amount)+1.5*c(f.maxChildAmount)),d.$(n).bubbleScale=M,y=b(f),n.currentCenter&&n.currentCenter==f.left?_=!0:n.currentCenter&&n.currentCenter==f.right&&(A=!0);var P=n.shortestAngleTo;A&&(P=n.shortestLeftTurn),_&&(P=n.shortestRightTurn),d.$(y).angle=P(y.angle,0),k=(c(f.amount)+c(f.maxChildAmount))*M+20,C=v(f),d.$(C).rad=k,m=b(f.parent),m.childRotation=-f.centerAngle;for(var S=m;S&&S.node.parent;)S=b(S.node.parent,!0),d.$(S).rad=0;d.$(m).rad=0;var R=.5*n.width;if(E=0-Math.max(.8*R-M*(c(f.parent.amount)+c(Math.max(1.15*f.amount+1.15*f.maxChildAmount,.85*f.left.amount,.85*f.right.amount))),M*c(f.parent.amount)*-1+.15*R)+R,f.left&&f.right){M*c(Math.max(f.left.amount,f.right.amount))}N=k+E,d.$(l).x=.5*n.width-E-(f!=O?.35*k:0),d.$(l).y=.5*n.height,new vis4.DelayedTask(1500,vis4,vis4.log,l,m.pos),E+=.1*n.width,C=v(f.parent),d.$(C).rad=E,d.$(y).rad=E;var j=0-(f!=O?O.centerAngle+y.childRotation:0);for(i in f.children)w=f.children[i],e=b(w),d.$(e).angle=n.shortestAngleTo(e.angle,w.centerAngle+y.childRotation+j),d.$(e).rad=k;var L=.07*n.height;f.left&&(x=f.left,T=c(x.amount)*M,B=p-Math.asin((.5*n.paper.height+T-L)/E),e=b(x),d.$(e).rad=E,d.$(e).angle=P(e.angle,B)),f.right&&(x=f.right,T=c(x.amount)*M,B=Math.asin((.5*n.paper.height+T-L)/E),e=b(x),d.$(e).rad=E,d.$(e).angle=P(e.angle,B)),f=O}for(i in n.displayObjects){var W=n.displayObjects[i];W.hideFlag&&W.visible?(d.$(W).alpha=0,"bubble"==W.className&&W.node.level>1&&(d.$(W).rad=0),d.hide(W)):W.hideFlag||(d.$(W).alpha=1,W.visible||(W.alpha=0,d.show(W)))}r=new o.Transitioner($.browser.msie||n.currentCenter==f?0:560),r.changeLayout(d),n.currentTransition=r,!n.currentCenter&&$.isFunction(n.config.firstNodeCallback)&&n.config.firstNodeCallback(f),n.currentCenter=f}else s.log("node "+t+" not found")},i.unifyAngle=function(t){for(var e=Math.PI,r=2*e;t>=r;)t-=r;for(;t<0;)t+=r;return t},i.shortestAngle=function(t,e){var r=Math.PI,n=2*r,a=i.unifyAngle;t=a(t),e=a(e);var o=e-t;return o>r&&(o-=n),o<-r&&(o+=n),o},i.shortestAngleTo=function(t,e){return t+i.shortestAngle(t,e)},i.shortestLeftTurn=function(t,e){var r=i.shortestAngle(t,e);return r>0&&(r-=2*Math.PI),t+r},i.shortestRightTurn=function(t,e){var r=i.shortestAngle(t,e);return r<0&&(r=2*Math.PI+r),t+r},i.getBubble=function(t,e){return this.getDisplayObject("bubble",t,e)},i.getRing=function(t){return this.getDisplayObject("ring",t)},i.getDisplayObject=function(t,e,r){var i,n,a=this;for(i in a.displayObjects)if(n=a.displayObjects[i],n.className==t&&n.node==e)return r||(n.hideFlag=!1),n;vis4.log(t+" not found for node",e)},i.initHistory=function(){$.history.init(i.urlChanged.bind(i),{unescape:",/"})},i.freshUrl="",i.urlChanged=function(t){var e=this,r=e.currentTransition;e.freshUrl||t.indexOf("/~/")&&(e.baseUrl=t.substr(0,t.indexOf("/~/"))),e.freshUrl=t,r&&r.running?(vis4.log("transition is running at the moment, adding listener"),r.onComplete(e.changeUrl.bind(e))):e.changeUrl()},i.changeUrl=function(){var t,e=this,r=e.freshUrl.split("/"),i=r[r.length-1];""===e.freshUrl&&e.navigateTo(e.treeRoot),e.nodesByUrlToken.hasOwnProperty(i)?(t=e.getUrlForNode(e.nodesByUrlToken[i]),e.freshUrl!=t?$.history.load(t):e.navigateTo(e.nodesByUrlToken[i],!0)):e.navigateTo(e.treeRoot)},i.navigateTo=function(t,e){var r=this;"function"==typeof r.config.navigateTo&&(console.log(e),r.config.navigateTo(t));var i=r.getUrlForNode(t);e?r.changeView(t.urlToken):$.history.load(i),$(".label, .label2").removeClass("current"),$(".label2."+t.id).addClass("current"),$(".label."+t.id).addClass("current")},i.getUrlForNode=function(t){var e=[];for(e.push(t.urlToken);t.parent;)e.push(t.parent.urlToken),t=t.parent;return e.reverse(),i.baseUrl+"/~/"+e.join("/")},i.onNodeClick=function(t){},i.clean=function(){$(".label").remove()},this.loop=function(){TWEEN.update()},!i.config.hasOwnProperty("data"))throw new Error("no data");"string"==typeof i.config.data?i.loadData():new vis4.DelayedTask(1e3,i,i.setData,i.config.data)};BubbleTree.Styles={},BubbleTree.Layout=function(){var t=this;t.objects=[],t.props=[],t.toHide=[],t.toShow=[],t.$=function(t){var e,r,i,n=this;for(e in n.objects)if(r=n.objects[e],r==t)return n.props[e];return n.objects.push(t),i={},n.props.push(i),i},t.show=function(t){var e=this;e.toShow.push(t)},t.hide=function(t){var e=this;e.toHide.push(t)}},BubbleTree.Line=function(t,e,r,i,n,a){this.bc=t,this.o=r,this.angle=i,this.fromRad=n,this.attr=e,this.toRad=a,this.getXY=function(){this.x1=this.o.x+Math.cos(this.angle)*this.fromRad,this.y1=this.o.y-Math.sin(this.angle)*this.fromRad,this.x2=this.o.x+Math.cos(this.angle)*this.toRad,this.y2=this.o.y-Math.sin(this.angle)*this.toRad},this.init=function(){this.getXY(),console.log("foo","M"+this.x1+" "+this.y1+"L"+this.x2+" "+this.y2,e),this.path=this.bc.paper.path("M"+this.x1+" "+this.y1+"L"+this.x2+" "+this.y2).attr(this.attr)},this.draw=function(){this.getXY(),this.path.attr({path:"M"+this.x1+" "+this.y1+"L"+this.x2+" "+this.y2})},this.init()},BubbleTree.Loader=function(t){var e=this;e.config=t,e.ns=BubbleTree,e.loadData=function(){var t=this,e=t.config.data;console.log("loading url ",e),$.ajax({url:e,context:t,dataType:"json",success:function(t){this.run(t)}})},e.run=function(t){var e=this,r=new BubbleTree(e.config);r.setData(t),e.config.instance=r},!e.config.hasOwnProperty("data"),"string"==typeof e.config.data?e.loadData():e.run(e.config.data)},BubbleTree.MouseEventGroup=function(t,e){var r=this;r.target=t,r.members=e,r.click=function(t){var e,r,i=this,n=i.members;i.clickCallback=t;for(e in n)r=n[e],$(r).click(i.handleClick.bind(i))},r.handleClick=function(t){var e=this;e.clickCallback({target:e.target,origEvent:t,mouseEventGroup:e})},r.hover=function(t){var e,r,i=this,n=i.members;i.hoverCallback=t;for(e in n)r=n[e],$(r).hover(i.handleMemberHover.bind(i),i.handleMemberUnHover.bind(i))},r.unhover=function(t){var e=this;e.unhoverCallback=t},r.wasHovering=!1,r.mouseIsOver=!1,r.handleMemberHover=function(t){var e=this;new vis4.DelayedTask(25,e,e.handleMemberHoverDelayed,t)},r.handleMemberHoverDelayed=function(t){var e=this;e.mouseIsOver=!0,e.wasHovering||(e.wasHovering=!0,$.isFunction(e.hoverCallback)&&e.hoverCallback({target:e.target,origEvent:t,mouseEventGroup:e}))},r.handleMemberUnHover=function(t){var e=this;e.mouseIsOver=!1,new vis4.DelayedTask(40,e,e.handleMemberUnHoverDelayed,t)},r.handleMemberUnHoverDelayed=function(t){var e=this;e.mouseIsOver||(e.wasHovering=!1,$.isFunction(e.unhoverCallback)&&e.unhoverCallback({target:e.target,origEvent:t,mouseEventGroup:e}))},r.addMember=function(t){var e=this;e.hoverCallback&&$(t).hover(e.handleMemberHover.bind(e),e.handleMemberUnHover.bind(e)),e.members.push(t)},r.removeMember=function(t){var e,r=this,i=r.members,n=[];r.clickCallback&&$(t).unbind("click"),r.hoverCallback&&$(t).unbind("mouseenter mouseleave");for(e in i)i[e]!=t&&n.push(i[e]);r.members=n}},BubbleTree.Ring=function(t,e,r,i,n){var a=this;a.className="ring",a.rad=i,a.bc=e,a.attr=n,a.origin=r,a.alpha=1,a.visible=!1,a.node=t,a.init=function(){},a.draw=function(){var t=this,e=t.origin;t.visible&&t.circle.attr({cx:e.x,cy:e.y,r:t.rad,"stroke-opacity":t.alpha})},a.hide=function(){var t=this;t.circle.remove(),t.visible=!1},a.show=function(){var t=this;t.circle=t.bc.paper.circle(r.x,r.y,t.rad).attr(t.attr),t.visible=!0,t.circle.toBack()},a.init()},BubbleTree.Transitioner=function(t){var e=this;e.duration=t,e.running=!1,e.completeCallbacks=[],e.changeLayout=function(t){var e,r,i,n,a=this;a.running=!0,a.layout=t;for(e in t.toShow)r=t.toShow[e],$.isFunction(r.show)&&r.show();for(e in t.objects)if(r=t.objects[e],void 0!==r&&null!==r)if(i=t.props[e],a.duration>0){var o=new TWEEN.Tween(r),s={};for(n in i)s[n]=i[n];o.to(s,.6*a.duration),o.easing(TWEEN.Easing.Exponential.EaseOut),$.isFunction(r.draw)&&o.onUpdate(r.draw.bind(r)),e==t.objects.length-1&&o.onComplete(a._completed.bind(a)),o.start()}else{for(n in i)r[n]=i[n];r&&$.isFunction(r.draw)&&r.draw()}if(0===a.duration){for(e in t.objects)r=t.objects[e],r&&$.isFunction(r.draw)&&r.draw();a._completed()}},e.onComplete=function(t){var e=this;try{$.isFunction(t)&&e.completeCallbacks.push(t)}catch(t){}},e._completed=function(){var t,e,r=this,i=r.completeCallbacks;r.running=!1;for(t in r.layout.objects)e=r.layout.objects[t],e&&$.isFunction(e.draw)&&e.draw();for(t in r.layout.toHide)e=r.layout.toHide[t],e&&$.isFunction(e.hide)&&e.hide();for(t in i)i[t]()}},BubbleTree.Utils={},BubbleTree.Utils.log=function(){try{window.hasOwnProperty("console")&&console.log.apply(this,arguments)}catch(t){}},BubbleTree.Utils.amount2rad=function(t){return Math.pow(Math.max(0,t)/BubbleTree.a2radBase,.6)},BubbleTree.Utils.formatNumber=function(t){var e="";return t<0&&(t*=-1,e="-"),t>=1e12?e+Math.round(t/1e11)/10+"t":t>=1e9?e+Math.round(t/1e8)/10+"b":t>=1e6?e+Math.round(t/1e5)/10+"m":t>=1e3?e+Math.round(t/100)/10+"k":e+t},BubbleTree.Vector=function(t,e){var r=this;r.x=t,r.y=e,r.length=function(){var t=this;return Math.sqrt(t.x*t.x+t.y*t.y)},r.normalize=function(t){var e=this,r=e.length();t||(t=1),e.x*=t/r,e.y*=t/r},r.clone=function(){var t=this;return new BubbleTree.Vector(t.x,t.y)}},BubbleTree.Bubbles=BubbleTree.Bubbles||{},BubbleTree.Bubbles=BubbleTree.Bubbles||{},BubbleTree.Bubbles.Donut=function(t,e,r,i,n,a){var o=BubbleTree,s=o.Utils,l=this;l.className="bubble",l.node=t,l.paper=e.paper,l.origin=r,l.bc=e,l.rad=i,l.angle=n,l.color=a,l.alpha=1,l.visible=!1,l.ns=o,l.bubbleRad=s.amount2rad(this.node.amount),l.childRotation=0,l.getXY=function(){var t=this,e=t.origin,r=t.angle,i=t.rad;t.pos.x=e.x+Math.cos(r)*i,t.pos.y=e.y-Math.sin(r)*i},l.init=function(){var t=this;t.pos=new t.ns.Vector(0,0),t.getXY();var e,r,i,n=[],a=[],o=t.bc.config.bubbleStyles;t.node.shortLabel||(t.node.shortLabel=t.node.label.length>50?t.node.label.substr(0,30)+"...":t.node.label),t.breakdownOpacities=[.2,.7,.45,.6,.35],t.breakdownColors=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1];for(r in t.node.breakdowns)e=t.node.breakdowns[r],e.famount=s.formatNumber(e.amount),i=e.amount/t.node.amount,n.push(i),a.push(e),o&&o.hasOwnProperty("name")&&o.name.hasOwnProperty(e.name)&&o.name[e.name].hasOwnProperty("opacity")&&(t.breakdownOpacities[a.length-1]=o.name[e.name].opacity),o&&o.hasOwnProperty("name")&&o.name.hasOwnProperty(e.name)&&o.name[e.name].hasOwnProperty("color")&&(t.breakdownColors[a.length-1]=o.name[e.name].color,t.breakdownOpacities[a.length-1]=1);t.node.breakdowns=a,t.breakdown=n;t.initialized=!0},l.onclick=function(e){var r=this;"function"==typeof r.bc.config.onClick&&r.bc.config.onClick(t),r.bc.navigateTo(r.node)},l.onhover=function(t){var e=this,r=e.bc.$container[0];t.node=e.node,t.target=e,t.bubblePos={x:e.pos.x,y:e.pos.y},t.mousePos={x:t.origEvent.pageX-r.offsetLeft,y:t.origEvent.pageY-r.offsetTop},t.type="SHOW",e.bc.tooltip(t)},l.onunhover=function(t){var e=this,r=e.bc.$container[0];t.node=e.node,t.target=e,t.type="HIDE",t.bubblePos={x:e.pos.x,y:e.pos.y},t.mousePos={x:t.origEvent.pageX-r.offsetLeft,y:t.origEvent.pageY-r.offsetTop},e.bc.tooltip(t)},this.draw=function(){var t=this,e=Math.max(5,t.bubbleRad*t.bc.bubbleScale),r=(t.pos.x,t.pos.y,t.getXY(),t.pos.x),i=t.pos.y;if(t.visible){t.alpha=0;var n={cx:r,cy:i,r:e,"fill-opacity":t.alpha,class:t.node.id+"-circle"};if(t.circle.attr(n),t.circle.node.setAttribute("class","circle-"+t.node.id),t.node.stroke?(t.dashedBorder.attr({cx:r,cy:i,r:e,"stroke-opacity":1}),t.dashedBorder.node.setAttribute("class",t.node.strokeClass)):t.node.dashed&&(t.dashedBorder.attr({cx:r,cy:i,r:e+3,"stroke-opacity":1,"stroke-dasharray":"- "}),t.dashedBorder.node.setAttribute("class","dashed")),t.breakdown.length>1){var a,o,s,l,c,h,u,f,d,p,b=.85*e,v=.5*-Math.PI;for(a in t.breakdown){p=t.breakdown[a]*Math.PI*2,o=r+Math.cos(v)*b,h=i+Math.sin(v)*b,s=r+Math.cos(v+p)*b,u=i+Math.sin(v+p)*b,l=r+Math.cos(v+p)*e,f=i+Math.sin(v+p)*e,c=r+Math.cos(v)*e,d=i+Math.sin(v)*e,v+=p;var g="M"+o+" "+h+" A"+b+","+b+" 0 "+(p>Math.PI?"1,1":"0,1")+" "+s+","+u+" L"+l+" "+f+" A"+e+","+e+" 0 "+(p>Math.PI?"1,0":"0,0")+" "+c+" "+d+" Z";t.breakdownArcs[a].attr({path:g,"stroke-opacity":.2*t.alpha,"fill-opacity":t.breakdownOpacities[a]*t.alpha})}}t.label.show(),t.label.css({width:2*e+"px",height:2*e+"px",opacity:1}),t.label.css({left:t.pos.x-e+"px",top:t.pos.y-e+"px"})}},this.hide=function(){var t,e=this;e.circle.remove(),e.dashedBorder.remove(),e.label.remove(),e.label2.remove(),e.visible=!1;for(t in e.breakdownArcs)e.breakdownArcs[t].remove()},l.show=function(){var e,r=this,i=Math.max(5,r.bubbleRad*r.bc.bubbleScale),n={stroke:!1};r.icon?n["fill-opacity"]=0:n.fill=r.color,r.circle=r.paper.circle(r.pos.x,r.pos.y,i).attr(n),$.isFunction(r.bc.config.initTooltip)&&r.bc.config.initTooltip(r.node,r.circle.node),r.dashedBorder=r.paper.circle(r.pos.x,r.pos.y,1.05*i).attr({stroke:r.node.stroke,"stroke-opacity":1,fill:!1,class:"dashed"});var a='<div class="desc">'+r.node.shortLabel+"</div>";if(r.node.icon&&(a+='<div class="icon-container"><img class="smooth node-img-'+r.node.id+'" src="'+r.node.icon+'"></div>'),r.node.images&&r.node.images.length){a+='<div class="images">';for(var e=0;e<r.node.images.length;e++){var o=t.images[e];a+='<img src="'+o+'" alt="profile">'}a+="</div>"}var s,l=r.node.icon?"transparent":r.color;r.node.detail&&!r.node.icon&&(s='<div class="card label '+r.node.id+'" > <div class="front" style="background: '+l+';">'+r.node.shortLabel+'</div> <div class="back" style="background: white; color: black;">'+r.node.detailContent+"</div> </div>");var c=s?s:'<div class="label '+r.node.id+(r.node.icon?" iconized ":"")+'" style="background:'+l+'">'+a+"</div>";r.label=$(c),r.node.detail&&!r.node.icon&&(r.label.flip({trigger:"manual"}),r.label.on("click",function(t){r.label.hasClass("current")&&$("."+r.node.id).flip("toggle")})),r.node.clazz&&r.label.addClass(r.node.clazz),r.bc.$container.append(r.label);var h=r.node;c=$(".label."+h.id),r.node.droppable&&r.enableDrop(h),h.timeProgress&&h.timeProgress<1&&(h.timeProgressBar&&h.timeProgressBar.destroy(),c.length&&(h.timeProgressBar=factory.build(c.get(0),"#009ddc","easeIn",h.timeProgress))),r.node.children.length>1&&($(r.circle.node).css({cursor:"pointer"}),$(r.label).css({cursor:"pointer"})),r.label2=$('<div class="label2 '+r.node.id+'"><span>'+r.node.shortLabel+"</span></div>"),r.bc.$container.append(r.label2);var u=[r.circle.node,r.label];if(r.breakdown.length>1){r.breakdownArcs={};for(e in r.breakdown){var f=r.breakdownColors[e]?r.breakdownColors[e]:"#fff",d=r.paper.path("M 0 0 L 2 2").attr({fill:f,"fill-opacity":.4*Math.random()+.3,stroke:"#fff"});r.breakdownArcs[e]=d,$.isFunction(r.bc.config.initTooltip)&&r.bc.config.initTooltip(r.node.breakdowns[e],d.node)}for(e in r.breakdownArcs)$(r.breakdownArcs[e].node).click(r.onclick.bind(r))}var p=new r.ns.MouseEventGroup(r,u);p.click(r.onclick.bind(r)),p.hover(r.onhover.bind(r)),p.unhover(r.onunhover.bind(r)),r.visible=!0},l.enableDrop=function(t){console.log("Enabling drop");var e=$(".label."+t.id),r=this;e.attr("drop","true"),e.addClass("droppable"),e.off("dragover"),e.off("dragleave"),e.off("dropover"),e.off("drop"),e.droppable({over:function(t,r){e.addClass("dragover")},out:function(t,r){e.removeClass("dragover")}}),e.on("dragover",function(t){t.stopPropagation(),t.preventDefault(),e.addClass("dragover")}),e.on("dragleave",function(t,r,i){t.stopPropagation(),t.preventDefault(),console.log("Dragging leave"),e.removeClass("dragover")}),e.on("drop",function(i,n,a){i.stopPropagation(),i.preventDefault(),e.removeClass("dragover"),r.bc.config.handleDrop(i,t)})},l.arcHover=function(t){var e,r=this,i=r.bc.$container[0],n=r.breakdownArcs,a=r.node.breakdowns;for(e in n)if(n[e].node==t.target)return t.node=a[e],t.bubblePos={x:r.pos.x,y:r.pos.y},t.mousePos={x:t.pageX-i.offsetLeft,y:t.pageY-i.offsetTop},t.target=r,t.type="SHOW",void r.bc.tooltip(t);vis4.log("cant find the breakdown node")},l.arcUnhover=function(t){var e,r=this,i=r.bc.$container[0],n=r.breakdownArcs,a=r.node.breakdowns;for(e in n)if(n[e].node==t.target)return t.node=a[e],t.bubblePos={x:r.pos.x,y:r.pos.y},t.mousePos={x:t.pageX-i.offsetLeft,y:t.pageY-i.offsetTop},t.type="HIDE",t.target=r,void r.bc.tooltip(t);vis4.log("cant find the breakdown node")},l.init()},BubbleTree.Bubbles=BubbleTree.Bubbles||{};