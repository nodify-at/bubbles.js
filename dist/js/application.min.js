"use strict";!function(){function t(t,i){function s(s,n,h){var r,e={enableDrop:s.enableDrop,handleDrop:s.handleDrop,enableFlip:s.enableFlip,disableNavigationSingleNode:s.disableNavigationSingleNode,scaleFactor:s.scaleFactor,ready:function(t){},navigateTo:s.navigateTo,onClick:function(t){"function"==typeof s.nodeSelected&&s.nodeSelected(t),t.clickCount=t.clickCount?t.clickCount+1:1,t.detail}},a=$(".bubbletree").get(0);s.$watch("data",function(n,h){if(n!==h&&!r){var o=t.parse(s.data);r=i.build(o,a,e)}},!0)}return{restrict:"A",scope:{nodeSelected:"=",navigateTo:"=",data:"=",scaleFactor:"@",disableNavigationSingleNode:"@",enableDrop:"@",enableFlip:"@",handleDrop:"="},link:s}}var i=angular.module("tribefire.bubble",[]);i.directive("tribefireBubble",t),t.$inject=["DataParser","BubbleTreeFactory"]}(),function(){function t(){function t(t,i,s){var n={};return n.enableDrop=s.enableDrop,n.handleDrop=s.handleDrop,n.enableFlip=s.enableFlip,n.disableNavigationSingleNode=s.disableNavigationSingleNode,n.data=t,n.container=i,n.bubbleType="donut",n.scaleFactor=s.scaleFactor,n.ready=function(i,n){$(".amount").remove(),s.ready(t)},n.navigateTo=s.navigateTo,n.onClick=s.onClick,n.rootPath="./",new BubbleTree(n)}return{build:t}}var i=angular.module("tribefire.bubble");i.factory("BubbleTreeFactory",t)}();var TWEEN=TWEEN||function(){var t,i,s,n,h=[];return{start:function(t){s=setInterval(this.update,1e3/(t||60))},stop:function(){clearInterval(s)},add:function(t){h.push(t)},remove:function(i){t=h.indexOf(i),t!==-1&&h.splice(t,1)},update:function(){for(t=0,i=h.length,n=(new Date).getTime();t<i;)h[t].update(n)?t++:(h.splice(t,1),i--)}}}();TWEEN.Tween=function(t){var i={},s={},n={},h=1e3,r=0,e=null,a=TWEEN.Easing.Linear.EaseNone,o=null,u=null,c=null;this.to=function(i,s){null!==s&&(h=s);for(var r in i)null!==t[r]&&(n[r]=i[r]);return this},this.start=function(){TWEEN.add(this),e=(new Date).getTime()+r;for(var h in n)null!==t[h]&&(i[h]=t[h],s[h]=n[h]-t[h]);return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(t){return r=t,this},this.easing=function(t){return a=t,this},this.chain=function(t){o=t},this.onUpdate=function(t){return u=t,this},this.onComplete=function(t){return c=t,this},this.update=function(n){var r,l;if(n<e)return!0;n=(n-e)/h,n=n>1?1:n,l=a(n);for(r in s)t[r]=i[r]+s[r]*l;return null!==u&&u.call(t,l),1!=n||(null!==c&&c.call(t),null!==o&&o.start(),!1)}},TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},TWEEN.Easing.Linear.EaseNone=function(t){return t},TWEEN.Easing.Quadratic.EaseIn=function(t){return t*t},TWEEN.Easing.Quadratic.EaseOut=function(t){return-t*(t-2)},TWEEN.Easing.Quadratic.EaseInOut=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},TWEEN.Easing.Cubic.EaseIn=function(t){return t*t*t},TWEEN.Easing.Cubic.EaseOut=function(t){return--t*t*t+1},TWEEN.Easing.Cubic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},TWEEN.Easing.Quartic.EaseIn=function(t){return t*t*t*t},TWEEN.Easing.Quartic.EaseOut=function(t){return-(--t*t*t*t-1)},TWEEN.Easing.Quartic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},TWEEN.Easing.Quintic.EaseIn=function(t){return t*t*t*t*t},TWEEN.Easing.Quintic.EaseOut=function(t){return(t-=1)*t*t*t*t+1},TWEEN.Easing.Quintic.EaseInOut=function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},TWEEN.Easing.Sinusoidal.EaseIn=function(t){return-Math.cos(t*Math.PI/2)+1},TWEEN.Easing.Sinusoidal.EaseOut=function(t){return Math.sin(t*Math.PI/2)},TWEEN.Easing.Sinusoidal.EaseInOut=function(t){return-.5*(Math.cos(Math.PI*t)-1)},TWEEN.Easing.Exponential.EaseIn=function(t){return 0==t?0:Math.pow(2,10*(t-1))},TWEEN.Easing.Exponential.EaseOut=function(t){return 1==t?1:-Math.pow(2,-10*t)+1},TWEEN.Easing.Exponential.EaseInOut=function(t){return 0==t?0:1==t?1:(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*(t-1))+2)},TWEEN.Easing.Circular.EaseIn=function(t){return-(Math.sqrt(1-t*t)-1)},TWEEN.Easing.Circular.EaseOut=function(t){return Math.sqrt(1- --t*t)},TWEEN.Easing.Circular.EaseInOut=function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},TWEEN.Easing.Elastic.EaseIn=function(t){var i,s=.1,n=.4;return 0==t?0:1==t?1:(n||(n=.3),!s||s<1?(s=1,i=n/4):i=n/(2*Math.PI)*Math.asin(1/s),-(s*Math.pow(2,10*(t-=1))*Math.sin(2*(t-i)*Math.PI/n)))},TWEEN.Easing.Elastic.EaseOut=function(t){var i,s=.1,n=.4;return 0==t?0:1==t?1:(n||(n=.3),!s||s<1?(s=1,i=n/4):i=n/(2*Math.PI)*Math.asin(1/s),s*Math.pow(2,-10*t)*Math.sin(2*(t-i)*Math.PI/n)+1)},TWEEN.Easing.Elastic.EaseInOut=function(t){var i,s=.1,n=.4;return 0==t?0:1==t?1:(n||(n=.3),!s||s<1?(s=1,i=n/4):i=n/(2*Math.PI)*Math.asin(1/s),(t*=2)<1?-.5*s*Math.pow(2,10*(t-=1))*Math.sin(2*(t-i)*Math.PI/n):s*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-i)*Math.PI/n)*.5+1)},TWEEN.Easing.Back.EaseIn=function(t){return t*t*(2.70158*t-1.70158)},TWEEN.Easing.Back.EaseOut=function(t){return(t-=1)*t*(2.70158*t+1.70158)+1},TWEEN.Easing.Back.EaseInOut=function(t){return(t*=2)<1?.5*t*t*(3.5949095*t-2.5949095):.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)},TWEEN.Easing.Bounce.EaseIn=function(t){return 1-TWEEN.Easing.Bounce.EaseOut(1-t)},TWEEN.Easing.Bounce.EaseOut=function(t){return(t/=1)<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},TWEEN.Easing.Bounce.EaseInOut=function(t){return t<.5?.5*TWEEN.Easing.Bounce.EaseIn(2*t):.5*TWEEN.Easing.Bounce.EaseOut(2*t-1)+.5};var vis4=function(){};vis4.log=function(){try{null!==window.console&&console.log.apply(this,arguments)}catch(t){}},vis4.str2time=function(t){var i=t.split(".");return Math.round(.001*Date.UTC(2e3+i[0],i[1]-1,i[2]))},vis4.round=function(t,i){var s=Math.pow(10,i);return Math.round(t*s)/s},vis4.formatNumber_ksep=".",vis4.formatNumber_dsep=",",vis4.formatNumber=function(t,i){t=""+t;for(var s="",n=0,h=t.length-1;h>=0;h--)n>0&&n<t.length&&n%3==0&&(s=vis4.formatNumber_ksep+s),s=t[h]+s,n++;return s},vis4.parseTSV=function(t,i){var s,n,h=t.split("\n"),r=[];for(n=0;n<h.length;n++){var e=h[n];if(""!==e)if(i)if(0===n)s=e.split("\t");else{var a={},o=e.split("\t");if(o.length!=s.length)return"wrong tsv format";for(var u=0;u<s.length;u++)a[$.trim(s[u])]=$.trim(o[u]);r.push(a)}else r.push(e.split("\t"))}return r},vis4.map=function(t,i){for(var s={},n=0;n<t.length;n++)s[t[n][i]]=t[n];return s},vis4.DelayedTask=function(){var t=this;t.init=function(t){var i=this,s=[];for(var n in t)n>2&&s.push(t[n]);i.func=t[2],i.scope=t[1],i.args=s,i.running=!0,i.timer=window.setTimeout(this.run.bind(i),t[0])},t.run=function(){var t=this;t.func.apply(t.scope,t.args),t.running=!1},t.cancel=function(){vis4.log("canceling timer",this),window.clearTimeout(this.timer),this.running=!1},t.init(arguments)};var vis4loadingItem=function(t,i,s,n){this.url=t,this.id=i,this.type=s,this.loader=n,this.load=function(){$.get(this.url,this.processContent.bind(this))},this.processContent=function(t){"tsv"==this.type?this.data=vis4.parseTSV(t,!0):"json"==this.type?this.data="string"==typeof t?$.parseJSON(t):t:this.data=t,this.loader.itemLoaded()}},vis4loader=function(){this.items=[],this.byID={},this.add=function(t,i,s){null===s&&(s="text");var n=new vis4loadingItem(t,i,s,this);this.items.push(n),this.byID[i]=n},this.load=function(t){this.callback=t,this.loaded=0;for(var i=0;i<this.items.length;i++)this.items[i].load()},this.itemLoaded=function(){this.loaded++,this.loaded==this.items.length&&this.callback(this)},this.get=function(t){return this.byID[t].data}};Function.prototype.bind=function(t){var i=this;return function(){return i.apply(t,arguments)}};var vis4color=function(t){this.h=0,this.s=.5,this.l=.8,this.v=1,this.i=1,this.r=255,this.g=0,this.b=0,this.x="#FF0000",this.u=0,this.br=1,this.K=1/180*Math.PI,"hsi"!=t&&"hsl"!=t&&"hsb"!=t&&"hsv"!=t||(this.mode=t),this.log=function(t){null!==window.console&&console.log(t)},this.cos=function(t){return Math.cos(t*this.K)},this.trim=function(t){return Math.max(0,Math.min(1,t))},this.setMode=function(t){"hsv"!=t&&"hsi"!=t&&"hsl"!=t&&"hsb"!=t&&this.log("unknown color mode "+t),this.mode=t,this.rgb2hsx()},this.setHexColor=function(t){"#"!=t.charAt(0)&&(t="#"+t),4==t.length&&(t="#"+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)+t.charAt(3)+t.charAt(3)),7!=t.length&&this.log("invalid hex color"),this.x=t,this.hex2int(),this.int2rgb(),this.rgb2hsx()},this.setRGBColor=function(t,i,s){this.r=t,this.b=s,this.g=i,this.rgb2int(),this.int2hex(),this.rgb2hsx()},this.setHSVColor=function(t,i,s){"hsv"!=this.mode&&(this.mode="hsv"),this.h=t,this.s=this.trim(i),this.v=this.trim(s),this.hsv2rgb(),this.rgb2int(),this.int2hex()},this.setHSLColor=function(t,i,s){"hsl"!=this.mode&&(this.mode="hsl"),this.h=t,this.s=this.trim(i),this.l=this.trim(s),this.hsl2rgb(),this.rgb2int(),this.int2hex()},this.setHSBColor=function(t,i,s){"hsb"!=this.mode&&(this.mode="hsb"),this.h=t,this.s=this.trim(i),this.b=this.trim(s),this.hsb2rgb(),this.rgb2int(),this.int2hex()},this.setHSIColor=function(t,i,s){"hsi"!=this.mode&&(this.mode="hsi"),this.h=t,this.s=this.trim(i),this.i=this.trim(s),this.hsi2rgb(),this.rgb2int(),this.int2hex()},this.onChange=function(){},this.rgb2int=function(){this.u=this.r<<16|this.g<<8|this.b,this.onChange()},this.int2rgb=function(){this.r=this.u>>16,this.g=this.u>>8&255,this.b=255&this.u},this.hex2int=function(){this.u=parseInt(this.x.substr(1),16),this.onChange()},this.int2hex=function(){var t="000000"+this.u.toString(16).toUpperCase();this.x="#"+t.substr(t.length-6),this.onChange()},this.int2rgb=function(){this.r=this.u>>16,this.g=this.u>>8&255,this.b=255&this.u},this.hsx2rgb=function(){switch(this.mode){case"hsv":this.hsv2rgb();break;case"hsi":this.hsi2rgb();break;case"hsl":this.hsl2rgb();break;case"hsb":this.hsb2rgb()}},this.rgb2hsx=function(){switch(this.mode){case"hsv":this.rgb2hsv();break;case"hsi":this.rgb2hsi();break;case"hsl":this.rgb2hsl();break;case"hsb":this.rgb2hsb()}},this.hue=function(t){return this._evaluate(t,"h"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this},this.saturation=function(t){return this._evaluate(t,"s"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this},this.lightness=function(t){return"hsl"!=this.mode?void this.log("WARNING: lightness property not available in "+this.mode+" mode"):(this._evaluate(t,"l"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this)},this.brightness=function(t){return"hsb"!=this.mode?void this.log("WARNING: brightness property not available in "+this.mode+" mode"):(this._evaluate(t,"br"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this)},this.value=function(t){return"hsv"!=this.mode?void this.log("WARNING: value property not available in "+this.mode+" mode"):(this._evaluate(t,"v"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this)},this.intensity=function(t){return"hsi"!=this.mode?void this.log("WARNING: intensity property not available in "+this.mode+" mode"):(this._evaluate(t,"i"),this.hsx2rgb(),this.rgb2int(),this.int2hex(),this)},this._evaluate=function(t,i){"string"==typeof t?("+"!=t.charAt(0)||isNaN(t.substr(1))?"-"!=t.charAt(0)||isNaN(t.substr(1))||(this[i]=this[i]-Number(t.substr(1))):this[i]=Number(this[i])+Number(t.substr(1)),"*"!=t.charAt(0)||isNaN(t.substr(1))?"/"!=t.charAt(0)||isNaN(t.substr(1))||(this[i]=this[i]/Number(t.substr(1))):this[i]=this[i]*Number(t.substr(1))):isNaN(t)||(this[i]=Number(t))},this.rgb=function(){return[this.r,this.g,this.b]},this.hsl=function(){return[this.h,this.s,this.l]},this.rgb2hsv=function(){var t=Math.min(Math.min(this.r,this.g),this.b),i=Math.max(Math.max(this.r,this.g),this.b),s=i-t;this.v=i/255,this.s=s/i,0===this.s?this.h=void 0:(this.r==i&&(this.h=(this.g-this.b)/s),this.g==i&&(this.h=2+(this.b-this.r)/s),this.b==i&&(this.h=4+(this.r-this.g)/s),this.h*=60,this.h<0&&(this.h+=360))},this.hsv2rgb=function(){var t,i,s,n,h,r=this.h,e=this.s,a=this._rgb,o=255*this.v;if(0===this.s&&isNaN(r))this.r=this.g=this.b=o;else switch(360==r&&(r=0),r/=60,t=Math.floor(r),i=r-t,s=o*(1-e),n=o*(1-e*i),h=o*(1-e*(1-i)),t){case 0:a(o,h,s);break;case 1:a(n,o,s);break;case 2:a(s,o,h);break;case 3:a(s,n,o);break;case 4:a(h,s,o);break;case 5:a(o,s,n)}},this._rgb=function(t,i,s){this.r=t,this.g=i,this.b=s},this.rgb2hsl=function(){var t=this.r/255,i=this.g/255,s=this.b/255,n=Math.min(Math.min(t,i),s),h=Math.max(Math.max(t,i),s);this.l=(h+n)/2,h==n?(this.s=0,this.h=void 0):this.l<.5?this.s=(h-n)/(h+n):this.s=(h-n)/(2-h-n),t==h?this.h=(i-s)/(h-n):i==h?this.h=2+(s-t)/(h-n):s==h&&(this.h=4+(t-i)/(h-n)),this.h*=60,this.h<0&&(this.h+=360)},this.hsl2rgb=function(){if(0===this.s)this.r=this.g=this.b=255*this.l;else{var t,i,s=[0,0,0],n=[0,0,0];i=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,t=2*this.l-i;var h=this.h/360;s[0]=h+1/3,s[1]=h,s[2]=h-1/3;for(var r=0;r<3;r++)s[r]<0&&(s[r]+=1),s[r]>1&&(s[r]-=1),6*s[r]<1?n[r]=t+6*(i-t)*s[r]:2*s[r]<1?n[r]=i:3*s[r]<2?n[r]=t+(i-t)*(2/3-s[r])*6:n[r]=t;this.r=255*n[0],this.g=255*n[1],this.b=255*n[2]}},this.rgb2hsb=function(){this.rgb2hsl(),this.br=this._rgbLuminance()},this._rgbLuminance=function(){return(.2126*this.r+.7152*this.g+.0722*this.b)/255},this.hsb2rgb=function(){var t,i=.001,s=0,n=1,h=.5;this.l=h,this.hsl2rgb(),t=this._rgbLuminance();for(var r=0;Math.abs(t-this.br)>i&&r<100;)t>this.br?n=h:s=h,h=(s+n)/2,this.l=h,this.hsl2rgb(),t=this._rgbLuminance(),r++;this.br=t},this.rgb2hsi=function(){var t,i=this.r,s=this.g,n=this.b,h=(Math.max(Math.max(i,s),n),i+s+n);i/=h,s/=h,n/=h,t=Math.min(Math.min(i,s),n),this.i=(i+s+n)/765,this.h=this.acos((i-.5*s-.5*n)/Math.sqrt((i-s)*(i-s)+(i-n)*(s-n))),this.s=1-3*t,n>s&&(this.h=360-this.h)},this.hsi2rgb=function(){var t,i,s,n=this.h,h=this.i,r=this.s,e=this.cos;n<=120?(i=(1-r)/3,t=(1+r*e(n)/e(60-n))/3,s=1-(i+t)):n<=240?(n-=120,t=(1-r)/3,s=(1+r*e(n)/e(60-n))/3,i=1-(t+s)):(n-=240,s=(1-r)/3,i=(1+r*e(n)/e(60-n))/3,t=1-(s+i)),t=Math.min(255,t*h*3*255),s=Math.min(255,s*h*3*255),i=Math.min(255,i*h*3*255)}};vis4color.fromHex=function(t,i){null==i&&(i="hsl");var s=new vis4color(i);return s.setHexColor(t),s},vis4color.fromRGB=function(t,i,s,n){null===n&&(n="hsl");var h=new vis4color(n);return h.setRGBolor(t,i,s),h},vis4color.fromHSV=function(t,i,s,n){null===n&&(n="hsl");var h=new vis4color(n);return h.setHSVColor(t,i,s),h},vis4color.fromHSL=function(t,i,s,n){null===n&&(n="hsl");var h=new vis4color(n);return h.setHSLColor(t,i,s),h},vis4color.fromHSB=function(t,i,s,n){null===n&&(n="hsl");var h=new vis4color(n);return h.setHSBColor(t,i,s),h},vis4color.fromHSI=function(t,i,s,n){null===n&&(n="hsl");var h=new vis4color(n);return h.setHSIColor(t,i,s),h};